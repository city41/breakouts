/**
* entropy.js 0.1.0 - framework for making games and not only games in entity system manner - build: 2015-07-22
*
* @author       Tymoteusz Dzienniak <tymoteusz.dzienniak@outlook.com>
* @license      {@link https://github.com/RainPhilosopher/Entropy/blob/master/LICENSE|MIT License}
*/

!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.Entropy=a()}}(function(){var a;return function b(a,c,d){function e(g,h){if(!c[g]){if(!a[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};a[g][0].call(k.exports,function(b){var c=a[g][1][b];return e(c?c:b)},k,k.exports,b,a,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){function d(a,b){void 0===a?a=31:"string"==typeof a&&(a=a.length),b=1!==b?0:2147483647;for(var c=31,e=Math.ceil(a/c),f=e;f--;)this[f]=b;if("string"==typeof a)for(f=a.length;f--;)this.set(f,a.charAt(f));var g=function(a,b,d,f){if(void 0===d&&(void 0===b?(b=0,d=e*c-1):d=b),0>b||b>d||d>=c*e)return null;for(var g=e;g--;){var h=Math.max(b,g*c),i=Math.min(d,c-1+c*g);if(i>=h){var j=~(1<<1+i%c)+(1<<h%c);0===f?a[g]&=j:a[g]^=~j}}return a};this.size=c*e,this.length=e,this.and=function(a){if(a instanceof d)for(var b=e;b--;)this[b]&=a[b]||0;return this},this.or=function(a){if(a instanceof d)for(var b=e;b--;)this[b]|=a[b]||0;return this},this.nand=function(a){if(a instanceof d)for(var b=e;b--;)this[b]=~(this[b]&(a[b]||0));return this},this.nor=function(a){if(a instanceof d)for(var b=e;b--;)this[b]=~(this[b]|(a[b]||0));return this},this.not=function(){for(var a=e;a--;)this[a]=~this[a];return this},this.xor=function(a){if(a instanceof d)for(var b=e;b--;)this[b]=this[b]^(a[b]||0);return this},this.equals=function(a){if(!(a instanceof d))return!1;var b=a,c=this;e>a.length&&(b=this,c=a);for(var f=b.length;f--;)if(f<c.length){if(b[f]!==c[f])return!1}else if(0!==b[f])return!1;return!0},this.subsetOf=function(a){if(!(a instanceof d))return!1;if(a.length!==e)return!1;for(var b=e;b--;)if((a[b]&this[b])!==this[b])return!1;return!0},this.clone=function(){for(var a=new d(this.size),b=e;b--;)a[b]=this[b];return a},this.isEmpty=function(){for(var a=e;a--;)if(0!==this[a])return!1;return!0},this.toString=function(a){for(var b="",d=e;d--;){e>d+1&&void 0!==a&&(b+=String(a));var f=this[d].toString(2);b+=new Array(1+c-f.length).join("0"),b+=f}return b},this.cardinality=function(){for(var a,b=0,c=e;c--;)for(a=this[c];a;a&=a-1,b++);return b},this.msb=function(){for(var a=e;a--;){var b=this[a],d=0;if(b){for(;b>>=1;d++);return c*a+d}}return 0},this.set=function(a,b){if(0>a)return null;void 0===b&&(b=1);var d=a/c;if(d>=e){e=Math.ceil(d);for(var f=this.length;e>f;f++)this[f]=0;this.size=c*e,this.length=e}return d=Math.floor(d),this[d]^=1<<a%c&(-(1&b)^this[d]),this},this.setRange=function(a,b,d){if(b>=a&&a>=0&&c*e>b){if("string"==typeof d){if(b-a!==d.length)return null;for(var f=0;f<d.length;f++)this.set(f+a,d.charAt(d.length-f-1))}else{void 0===d&&(d=1);for(var f=a;b>=f;f++)this.set(f,d)}return this}return null},this.get=function(a){return a>=0&&c*e>a?this[a/c|0]>>a%c&1:null},this.getRange=function(a,b){if(b>=a&&a>=0&&c*e>b){for(var f=new d(b-a+1),g=a;b>=g;g++)f.set(g-a,this.get(g));return f}return null},this.clear=function(a,b){return g(this,a,b,0)},this.flip=function(a,b){return g(this,a,b,1)}}"undefined"!=typeof b&&b.exports&&(b.exports.BitSet=d)},{}],2:[function(b,c,d){!function(b){"use strict";function d(a,b){var c;for(c in b)if(b.hasOwnProperty(c)){if(a.hasOwnProperty(c)===!1||typeof a[c]!=typeof b[c])return!1;if(g(a[c])&&d(a[c],b[c])===!1)return!1}return!0}function e(a,b){return a&&r(b)&&a instanceof b?!0:!1}function f(a){return g(a)&&0===Object.keys(a).length}function g(a){return"[object Object]"===Object.prototype.toString.call(a)}function h(a){return!i(a)&&!j(a)}function i(a){return void 0===a}function j(a){return null===a}function k(a,b){return h(a)&&a.length===b}function l(a){return m(a)&&0===a.length}function m(a){return Array.isArray(a)}function n(a){return h(a)&&H(a.length)}function o(a){return"undefined"==typeof Symbol?n(a):h(a)&&r(a[Symbol.iterator])}function p(a){return"[object Date]"===Object.prototype.toString.call(a)&&!isNaN(a.getTime())}function q(a){return"[object Error]"===Object.prototype.toString.call(a)}function r(a){return"function"==typeof a}function s(a,b){return v(a)&&!!a.match(b)}function t(a,b){return v(a)&&-1!==a.indexOf(b)}function u(a){return v(a)&&""!==a}function v(a){return"string"==typeof a}function w(a){return y(a)&&!x(a)}function x(a){return H(a)&&a%2===0}function y(a){return H(a)&&a%1===0}function z(a,b,c){return c>b?A(a,b)&&B(a,c):B(a,b)&&A(a,c)}function A(a,b){return H(a)&&a>=b}function B(a,b){return H(a)&&b>=a}function C(a,b,c){return c>b?D(a,b)&&E(a,c):E(a,b)&&D(a,c)}function D(a,b){return H(a)&&a>b}function E(a,b){return H(a)&&b>a}function F(a){return D(a,0)}function G(a){return E(a,0)}function H(a){return"number"==typeof a&&isNaN(a)===!1&&a!==Number.POSITIVE_INFINITY&&a!==Number.NEGATIVE_INFINITY}function I(a){return 0===a}function J(a){return a===!1||a===!0}function K(a,b){return ma.array(a),r(b)?a.map(function(a){return b(a)}):(ma.array(b),ma.hasLength(a,b.length),a.map(function(a,c){return b[c](a)}))}function L(a,b){return ma.object(a),r(b)?M(a,b):(ma.object(b),N(a,b))}function M(a,b){var c={};return Object.keys(a).forEach(function(d){c[d]=b(a[d])}),c}function N(a,b){var c={};return Object.keys(b).forEach(function(d){var e=b[d];r(e)?na.assigned(a)?c[d]=!!e._isMaybefied:c[d]=e(a[d]):g(e)&&(c[d]=N(a[d],e))}),c}function O(a){return m(a)?P(a,!1):(ma.object(a),Q(a,!1))}function P(a,b){var c;for(c=0;c<a.length;c+=1)if(a[c]===b)return b;return!b}function Q(a,b){var c,d;for(c in a)if(a.hasOwnProperty(c)){if(d=a[c],g(d)&&Q(d,b)===b)return b;if(d===b)return b}return!b}function R(a){return m(a)?P(a,!0):(ma.object(a),Q(a,!0))}function S(a,b){return Object.keys(b).forEach(function(c){a[c]=b[c]}),a}function T(a,b){return function(){U(a,arguments,b)}}function U(a,b,c){var d=b[b.length-1];V(a.apply(null,b),u(d)?d:c)}function V(a,b){if(a===!1)throw new Error(b||"Assertion failed")}function W(a,b){return function(){function c(a,b){return a[b]=function(){if(d&&!ka[b].apply(null,arguments))throw d},a}var d;try{U(a,arguments,b)}catch(e){d=e}return{or:Object.keys(ka).reduce(c,{})}}}function X(a){return function(){return Y(a.apply(null,arguments))}}function Y(a){return!a}function Z(a){var b=function(){return h(arguments[0])?a.apply(null,arguments):!0};return b._isMaybefied=!0,b}function $(a){return h(a)===!1?!0:a}function _(a){function b(){return!0}return function(){function c(a,c){return a[c]=d?b:ka[c],a}var d=a.apply(null,arguments);return{or:Object.keys(ka).reduce(c,{})}}}function aa(a,b,c){return function(){var d,e;if(d=arguments[0],!b(d))return!1;d=ba(b,d),e=ra.call(arguments,1);try{d.forEach(function(b){if(("maybe"!==a||h(b))&&!c.apply(null,[b].concat(e)))throw 0})}catch(f){return!1}return!0}}function ba(a,b){switch(a){case n:return ra.call(b);case g:return Object.keys(b).map(function(a){return b[a]});default:return b}}function ca(a,b){return da([a,ka,b])}function da(a){var b,c,d,e;return b=a.shift(),c=a.pop(),d=a.pop(),e=c||{},Object.keys(d).forEach(function(c){Object.defineProperty(e,c,{configurable:!1,enumerable:!0,writable:!1,value:b.apply(null,a.concat(d[c],ja[c]))})}),e}function ea(a,b){return da([a,b,null])}function fa(a){ka[a].of=da([aa.bind(null,null),ka[a],ka,null])}function ga(a,b){qa.forEach(function(c){a[c].of=ea(b,ka[c].of)})}function ha(a){oa[a].of=da([aa.bind(null,"maybe"),ka[a],ka,null]),ma.maybe[a].of=ea(T,oa[a].of),ma.not[a].of=ea(T,na[a].of)}function ia(d){"function"==typeof a&&a.amd?a(function(){return d}):"undefined"!=typeof c&&null!==c&&c.exports?c.exports=d:b.check=d}var ja,ka,la,ma,na,oa,pa,qa,ra;ja={like:"Invalid type",instance:"Invalid type",emptyObject:"Invalid object",object:"Invalid object",assigned:"Invalid value",undefined:"Invalid value","null":"Invalid value",hasLength:"Invalid length",emptyArray:"Invalid array",array:"Invalid array",arrayLike:"Invalid array-like object",iterable:"Invalid iterable",date:"Invalid date",error:"Invalid error",fn:"Invalid function",match:"Invalid string",contains:"Invalid string",unemptyString:"Invalid string",string:"Invalid string",odd:"Invalid number",even:"Invalid number",inRange:"Invalid number",greaterOrEqual:"Invalid number",lessOrEqual:"Invalid number",between:"Invalid number",greater:"Invalid number",less:"Invalid number",positive:"Invalid number",negative:"Invalid number",integer:"Invalid number",zero:"Invalid number",number:"Invalid number","boolean":"Invalid boolean"},ka={like:d,instance:e,emptyObject:f,object:g,assigned:h,undefined:i,"null":j,hasLength:k,emptyArray:l,array:m,arrayLike:n,iterable:o,date:p,error:q,"function":r,match:s,contains:t,unemptyString:u,string:v,odd:w,even:x,inRange:z,greaterOrEqual:A,lessOrEqual:B,between:C,greater:D,less:E,positive:F,negative:G,integer:y,zero:I,number:H,"boolean":J},la={apply:K,map:L,all:O,any:R},qa=["array","arrayLike","iterable","object"],ra=Array.prototype.slice,la=S(la,ka),ma=ca(T,V),na=ca(X,Y),oa=ca(Z,$),pa=ca(_),ma.not=ea(T,na),ma.maybe=ea(T,oa),ma.either=ea(W,ka),qa.forEach(fa),ga(ma,T),ga(na,X),qa.forEach(ha),ia(S(la,{assert:ma,not:na,maybe:oa,either:pa}))}(this)},{}],3:[function(b,c,d){!function(b,e){"function"==typeof a&&a.amd?a([],e):"object"==typeof d?c.exports=e():b.Inverse=e()}(this,function(){"use strict";var a=function(){this._boundCallbacks={},this._singletonCallbacks={},this._instantiatedSingletons={},this._registeredObjects={}};return a.prototype.make=function(a){if(this._registeredObjects.hasOwnProperty(a))return this._registeredObjects[a];var b=Array.prototype.slice.call(arguments,1);return this._singletonCallbacks.hasOwnProperty(a)?(this._instantiatedSingletons.hasOwnProperty(a)||(this._instantiatedSingletons[a]=this._singletonCallbacks[a].apply(this,b)),this._instantiatedSingletons[a]):this._boundCallbacks.hasOwnProperty(a)?this._boundCallbacks[a].apply(this,b):null},a.prototype.bind=function(a,b){this._boundCallbacks[a]=b},a.prototype.singleton=function(a,b){this._singletonCallbacks[a]=b},a.prototype.register=function(a,b){this._registeredObjects[a]=b},a})},{}],4:[function(a,b,c){b.exports=a("./lib/extend")},{"./lib/extend":5}],5:[function(a,b,c){function d(){var a,b,c,f,g,h,i=arguments[0]||{},j=1,k=arguments.length,l=!1;for("boolean"==typeof i&&(l=i,i=arguments[1]||{},j=2),"object"==typeof i||e.fn(i)||(i={});k>j;j++)if(a=arguments[j],null!=a){"string"==typeof a&&(a=a.split(""));for(b in a)c=i[b],f=a[b],i!==f&&(l&&f&&(e.hash(f)||(g=e.array(f)))?(g?(g=!1,h=c&&e.array(c)?c:[]):h=c&&e.hash(c)?c:{},i[b]=d(l,h,f)):"undefined"!=typeof f&&(i[b]=f))}return i}var e=a("is");d.version="1.1.3",b.exports=d},{is:6}],6:[function(a,b,c){var d,e=Object.prototype,f=e.hasOwnProperty,g=e.toString;"function"==typeof Symbol&&(d=Symbol.prototype.valueOf);var h=function(a){return a!==a},i={"boolean":1,number:1,string:1,undefined:1},j=/^([A-Za-z0-9+\/]{4})*([A-Za-z0-9+\/]{4}|[A-Za-z0-9+\/]{3}=|[A-Za-z0-9+\/]{2}==)$/,k=/^[A-Fa-f0-9]+$/,l=b.exports={};l.a=l.type=function(a,b){return typeof a===b},l.defined=function(a){return"undefined"!=typeof a},l.empty=function(a){var b,c=g.call(a);if("[object Array]"===c||"[object Arguments]"===c||"[object String]"===c)return 0===a.length;if("[object Object]"===c){for(b in a)if(f.call(a,b))return!1;return!0}return!a},l.equal=function(a,b){var c=a===b;if(c)return!0;var d,e=g.call(a);if(e!==g.call(b))return!1;if("[object Object]"===e){for(d in a)if(!(l.equal(a[d],b[d])&&d in b))return!1;for(d in b)if(!(l.equal(a[d],b[d])&&d in a))return!1;return!0}if("[object Array]"===e){if(d=a.length,d!==b.length)return!1;for(;--d;)if(!l.equal(a[d],b[d]))return!1;return!0}return"[object Function]"===e?a.prototype===b.prototype:"[object Date]"===e?a.getTime()===b.getTime():c},l.hosted=function(a,b){var c=typeof b[a];return"object"===c?!!b[a]:!i[c]},l.instance=l["instanceof"]=function(a,b){return a instanceof b},l.nil=l["null"]=function(a){return null===a},l.undef=l.undefined=function(a){return"undefined"==typeof a},l.args=l.arguments=function(a){var b="[object Arguments]"===g.call(a),c=!l.array(a)&&l.arraylike(a)&&l.object(a)&&l.fn(a.callee);return b||c},l.array=function(a){return"[object Array]"===g.call(a)},l.args.empty=function(a){return l.args(a)&&0===a.length},l.array.empty=function(a){return l.array(a)&&0===a.length},l.arraylike=function(a){return!!a&&!l["boolean"](a)&&f.call(a,"length")&&isFinite(a.length)&&l.number(a.length)&&a.length>=0},l["boolean"]=function(a){return"[object Boolean]"===g.call(a)},l["false"]=function(a){return l["boolean"](a)&&Boolean(Number(a))===!1},l["true"]=function(a){return l["boolean"](a)&&Boolean(Number(a))===!0},l.date=function(a){return"[object Date]"===g.call(a)},l.element=function(a){return void 0!==a&&"undefined"!=typeof HTMLElement&&a instanceof HTMLElement&&1===a.nodeType},l.error=function(a){return"[object Error]"===g.call(a)},l.fn=l["function"]=function(a){var b="undefined"!=typeof window&&a===window.alert;return b||"[object Function]"===g.call(a)},l.number=function(a){return"[object Number]"===g.call(a)},l.infinite=function(a){return a===1/0||a===-(1/0)},l.decimal=function(a){return l.number(a)&&!h(a)&&!l.infinite(a)&&a%1!==0},l.divisibleBy=function(a,b){var c=l.infinite(a),d=l.infinite(b),e=l.number(a)&&!h(a)&&l.number(b)&&!h(b)&&0!==b;return c||d||e&&a%b===0},l["int"]=function(a){return l.number(a)&&!h(a)&&a%1===0},l.maximum=function(a,b){if(h(a))throw new TypeError("NaN is not a valid value");if(!l.arraylike(b))throw new TypeError("second argument must be array-like");for(var c=b.length;--c>=0;)if(a<b[c])return!1;return!0},l.minimum=function(a,b){if(h(a))throw new TypeError("NaN is not a valid value");if(!l.arraylike(b))throw new TypeError("second argument must be array-like");for(var c=b.length;--c>=0;)if(a>b[c])return!1;return!0},l.nan=function(a){return!l.number(a)||a!==a},l.even=function(a){return l.infinite(a)||l.number(a)&&a===a&&a%2===0},l.odd=function(a){return l.infinite(a)||l.number(a)&&a===a&&a%2!==0},l.ge=function(a,b){if(h(a)||h(b))throw new TypeError("NaN is not a valid value");return!l.infinite(a)&&!l.infinite(b)&&a>=b},l.gt=function(a,b){if(h(a)||h(b))throw new TypeError("NaN is not a valid value");return!l.infinite(a)&&!l.infinite(b)&&a>b},l.le=function(a,b){if(h(a)||h(b))throw new TypeError("NaN is not a valid value");return!l.infinite(a)&&!l.infinite(b)&&b>=a},l.lt=function(a,b){if(h(a)||h(b))throw new TypeError("NaN is not a valid value");return!l.infinite(a)&&!l.infinite(b)&&b>a},l.within=function(a,b,c){if(h(a)||h(b)||h(c))throw new TypeError("NaN is not a valid value");if(!l.number(a)||!l.number(b)||!l.number(c))throw new TypeError("all arguments must be numbers");var d=l.infinite(a)||l.infinite(b)||l.infinite(c);return d||a>=b&&c>=a},l.object=function(a){return"[object Object]"===g.call(a)},l.hash=function(a){return l.object(a)&&a.constructor===Object&&!a.nodeType&&!a.setInterval},l.regexp=function(a){return"[object RegExp]"===g.call(a)},l.string=function(a){return"[object String]"===g.call(a)},l.base64=function(a){return l.string(a)&&(!a.length||j.test(a))},l.hex=function(a){return l.string(a)&&(!a.length||k.test(a))},l.symbol=function(a){return"function"==typeof Symbol&&"[object Symbol]"===g.call(a)&&"symbol"==typeof d.call(a)}},{}],7:[function(a,b,c){var d=a("check-types"),e={debug:3,max_components_count:100,max_frame_time:20,time_factor:1,default_fps:60,ids_to_reuse_pool_size:1e3,initial_components_pool_size:1e3,initial_entities_pool_size:1e3},f={};b.exports=function(a,b){if(!d.not.unemptyString(a))if(null==b){if(a in f)return f[a];if(a in e)return e[a]}else f[a]=b}},{"check-types":2}],8:[function(a,b,c){"use strict";var d=a("check-types"),e=a("./debug");b.exports=function(a,b){return d.not.unemptyString(a)?void e.warn("constans key should be non-empty string"):(a=a.toUpperCase(),a in this?void e.warn("cannot define same constans twice: %s".key):(Object.defineProperty(this,a,{value:b}),b))}},{"./debug":9,"check-types":2}],9:[function(a,b,c){"use strict";var d=a("./config");b.exports={log:function(){d("debug")>=3&&console.log.apply(console,arguments)},warn:function(){d("debug")>=2&&console.warn.apply(console,arguments)},error:function(){d("debug")>=1&&console.error.apply(console,arguments)}}},{"./config":7}],10:[function(a,b,c){"use strict";function d(a){l.call(this),this.game=a,this._greatestEntityID=0,this._idsToReuse=new m(f("ids_to_reuse_pool_size")),this._systems=[],this._entities=g.alloc(1e4),this._modifiedEntities=g.alloc(1e4),this._modifiedEntitiesLength=0,this._entitiesToAdd=new m(1e3),this._entitiesToRemove=new m(1e3),this._systemsToAdd=new m(1e3),this._systemsToRemove=new m(1e3),this._entitiesPool={},this._componentsPool={},this._queries=[],this._entitiesCount=0,this._isClearingScheduled=!1,this._wasClearingPerformed=!1}var e=a("node.extend"),f=a("./config"),g=a("./fastarray"),h=a("check-types"),i=a("./debug"),j=a("./register"),k=Array.prototype.slice,l=a("./event"),m=a("./pool"),n=a("./entity");e(d.prototype,l.prototype),e(d.prototype,{create:function(a){if(h.not.unemptyString(a))return i.warn("entity name must be a string"),this;var b=j.getEntityPattern(a);if(h.not.object(b))return i.warn("entity pattern for %s does not exist",a),this;var c=k.call(arguments,1);c.unshift(this.game),null==this._entitiesPool[a]&&(this._entitiesPool[a]=new m(f("initial_entities_pool_size")));var d=this._entitiesPool[a].get();return d=d||new n(a,b,this),b.create.apply(d,c),this._entitiesToAdd.put(d),this},remove:function(a){return h.not.object(a)?(i.error("entity to remove has to be an object."),this):(this._entitiesToRemove.put(a),this)},getAllEntities:function(){},getEntities:function(a){return-1===this._queries.indexOf(a)&&this._initializeQuery(a),a.entities},getOne:function(a){return this.getEntities(a)[0]},addSystem:function(a){var b,c;if(h.array(a)){if(2!==a.length)return i.warn("To add system with priority you must provide an array with two elements - [systemName, priority] - as a first parameter."),this;b=a[0],c=a[1]}else{if(!h.unemptyString(a))return i.warn("First argument for addSystem method must be either system name or array with system name and desired priority."),this;b=a}var d=j.getSystemPattern(b);if(h.not.object(d))return i.warn("There is no system %s.",b),this;if(d.singleton){for(var f=!1,g=0,k=this._systems.length;k>g;g++)if(this._systems[g].name===d.name){f=!0;break}if(this._systemsToAdd.each(function(a){a.name===d.name&&(f=!0)}),f)return i.info("System you want to add is a singleton and there is one already present in the engine. Returning..."),this}var l=Array.prototype.slice.call(arguments,1);null==c&&(c=h.number(d.priority)?d.priority:0);var m=e(!0,{},d);return m.priority=c,m.engine=this,m.game=this.game,h["function"](m.initialize)&&m.initialize.apply(m,l),this._systemsToAdd.put(m),this},removeSystem:function(a){var b;if(h.object(a))b=a;else{if(!h.unemptyString(a))return i.warn("System to remove has to be an object or a string (system name)."),this;for(var c=0;c<this._systems.length;c++)if(this._systems[c].name===a){b=this._systems[c];break}if(null==b)return i.log("there is no such system: %s",a),this}return this._systemsToRemove.put(b),this},enableSystem:function(a){this._toggleSystem(a,!1)},disableSystem:function(a){this._toggleSystem(a,!0)},hasSystem:function(a,b){},_toggleSystem:function(a,b){if(null!=a)if(h.object(a))a._disabled=b;else if(h.unemptyString(a))for(var c,d=0;d<this._systems.length;d++)if(c=this._systems[d],c.name===a)return void(c._disabled=b)},markModifiedEntity:function(a){0!==a.id&&-1===g.indexOf(this._modifiedEntities,this._modifiedEntitiesLength,a.id)&&g.push(this._modifiedEntities,this._modifiedEntitiesLength++,a.id)},clear:function(){this._isClearingScheduled=!0},_performScheduledClearing:function(){for(var a,b,c,d=1;d<=this._greatestEntityID;d++)a=this._entities[d],null!=a&&0!==a.id&&this._entitiesToRemove.put(a);for(;b=this._entitiesToAdd.get();)h["function"](b.pattern.remove)&&b.pattern.remove.call(b,this.game),this._entitiesPool[b.pattern.name].put(b);for(;c=this._systemsToAdd.get();)h["function"](c.remove)&&c.remove();for(var d=0,e=this._systems.length;e>d;d++)this._systemsToRemove.put(this._systems[d])},update:function(a){for(var b,c=a.delta,d=0,e=this._systems.length;e>d;d++)b=this._systems[d],b._disabled||b.update(c);this._isClearingScheduled&&(this._performScheduledClearing(),this._wasClearingPerformed=!0),this._removeEntities(),this._addEntities(),this._modifyEntities(),this._removeSystems(),this._addSystems(),this._fetchQueries(),this._wasClearingPerformed&&(this.emit("cleared"),this._wasClearingPerformed=!1,this._isClearingScheduled=!1)},_removeEntities:function(){for(var a,b,c,d,e,f,i,j=this._queries,k=this._entities;a=this._entitiesToRemove.get();)if(0!==a.id){for(b=0,c=j.length;c>b;b++)i=j[b],i.satisfiedBy(a)&&(d=i.index,e=g.indexOf(d,i.indexLength,a.id),-1!==e&&(i.touched=!0,g.removeAtIndexConst(d,i.indexLength--,e)));h["function"](a.pattern.remove)&&a.pattern.remove.call(a,this.game),k[a.id]=0,a.id=0,f=a.name,this._entitiesPool[f].put(a),this._entitiesCount-=1,this.emit("entityRemoved",a)}},_addEntities:function(){for(var a,b,c,d,e,f=this._queries,h=this._entities;d=this._entitiesToAdd.get();){for(a=this._generateEntityID(),a>h.length&&g.extend(h,Math.round(1.25*h.length)),d.id=a,h[a]=d,b=0,c=this._queries.length;c>b;b++)e=f[b],e.satisfiedBy(d)&&(e.touched=!0,g.push(e.index,e.indexLength++,a));this._entitiesCount+=1,this.emit("entityAdded",d)}},_modifyEntities:function(){for(var a,b,c,d,e,f,h=0,i=this._queries,j=this._entities,k=this._modifiedEntities;f=j[k[h]];){for(f.applyModifications(),a=0,d=this._queries.length;d>a;a++){e=i[a],b=e.index,c=e.indexLength;var l=e.satisfiedBy(f),m=g.indexOf(b,c,f.id);l&&-1===m?(e.touched=!0,g.push(b,e.indexLength++,f.id)):l||-1===m||(e.touched=!0,g.removeAtIndexConst(b,e.indexLength--,m))}h++}g.clear(this._modifiedEntities,this._modifiedEntitiesLength),this._modifiedEntitiesLength=0},_removeSystems:function(){for(var a;a=this._systemsToRemove.get();){var b=this._systems.indexOf(a);-1!==b&&(h["function"](a.remove)&&a.remove(),g.removeAtIndex(this._systems,b),this.emit("systemRemoved",a))}},_addSystems:function(){for(var a,b;a=this._systemsToAdd.get();){var c=0,d=a.priority;for(b=this._systems.length;b>c&&!(this._systems[c].priority>d);c++);this._systems.splice(c,0,a),this.emit("systemAdded",a)}},_fetchQueries:function(){var a,b,c,d,e,f=this._entities,h=this._queries;for(a=0,d=this._queries.length;d>a;a++)if(e=h[a],e.touched){c=e.index;for(var i=e.entities,j=0,k=0;b=c[k];)g.push(i,j++,f[b]),k+=1;g.push(i,j,0),e.entitiesLength=j,e.touched=!1}},_getNewComponent:function(a){var b,c=j.getComponentPattern(a),d=!1;return h.not.object(c)?null:(null==this._componentsPool[a]&&(this._componentsPool[a]=new m(f("initial_components_pool_size")),d=!0),b=this._componentsPool[a].get(),null==b?b={_pattern:c}:h["function"](b._pattern.reset)&&b._pattern.reset.call(b),b)},_addComponentToPool:function(a){null==this._componentsPool[name]&&(this._componentsPool[name]=new m(f("initial_components_pool_size"))),this._componentsPool[a._pattern.name].put(a)},_generateEntityID:function(){var a=this._idsToReuse.get();return null==a&&(a=++this._greatestEntityID),a},_initializeQuery:function(a){for(var b,c=g.alloc(1e3),d=0,f=g.alloc(1e3),h=0,i=1,j=this._greatestEntityID;j>=i;i++)b=this._entities[i],0!==b&&a.satisfiedBy(b)&&(g.push(f,h++,b.id),g.push(c,d++,b));e(a,{entities:c,entitiesLength:d,index:f,indexLength:h,touched:!1}),this._queries.push(a)}}),b.exports=d},{"./config":7,"./debug":9,"./entity":11,"./event":12,"./fastarray":13,"./pool":17,"./register":19,"check-types":2,"node.extend":4}],11:[function(a,b,c){"use strict";function d(a,b,c){k.call(this),this.engine=c,this.pattern=b,this.bitset=new l(h("max_components_count")),this._modifications=[],this.id=0,this.name=a,this.components={},this._setDefaults()}var e=a("check-types"),f=a("./debug"),g=a("node.extend"),h=a("./config"),i=a("./register"),j=Array.prototype.slice,k=a("./event"),l=a("bitset.js").BitSet;g(d.prototype,k.prototype),g(d.prototype,{add:function(a){if(e.not.unemptyString(a))return f.warn("component name must be a non-empty string"),this;var b=a.toLowerCase(),c=this.components[b];if(null==c){if(c=this.engine._getNewComponent(b),null==c)return f.warn("there is no component pattern with name %s",a),this}else e["function"](c._pattern.reset)&&c._pattern.reset.call(c);var d=j.call(arguments,1);return c._pattern.initialize.apply(c,d),this.components[b]=c,0===this.id?this.bitset.set(i.getComponentID(b)):(this._modifications.push({fn:function(){this.bitset.set(i.getComponentID(b))}}),this.engine.markModifiedEntity(this)),this},remove:function(a){if(e.not.unemptyString(a))return f.warn("component name must be a non-empty string"),this;var b=a.toLowerCase(),c=i.getComponentID(b);return this.bitset.get(c)?(0===this.id?this._removeComponent(b,c):(this._modifications.push({fn:this._removeComponent,args:[b,c]}),this.engine.markModifiedEntity(this)),this):(f.warn('this entity does not have such component "%s" - nothing to remove',a),this)},_removeComponent:function(a,b){this.engine._addComponentToPool(this.components[a]),this.components[a]=null,this.bitset.clear(b)},get:function(a){return e.not.unemptyString(a)?(f.warn("component name must be a non-empty string"),this):this.components[a.toLowerCase()]},reset:function(){return e["function"](this.pattern.reset)&&this.pattern.reset.call(this,this.engine.game),this._setDefaults(),this},applyModifications:function(){for(var a;a=this._modifications.shift();)a.fn.apply(this,a.args)},clearModifications:function(){for(;this._modifications.shift(););},_setDefaults:function(){this.bitset.clear(),this._inFinalState=!1,this._remainingStateChanges=[],this._stateObject={},this._currentStates=[],this._stateChanges=[]}}),b.exports=d},{"./config":7,"./debug":9,"./event":12,"./register":19,"bitset.js":1,"check-types":2,"node.extend":4}],12:[function(a,b,c){"use strict";function d(){this._events={}}var e=a("check-types"),f=a("node.extend"),g=Array.prototype.slice;f(d.prototype,{on:function(a,b,c,d){e.not.string(a)||e.not["function"](b)||(this._events[a]=this._events[a]||[],this._events[a].push({fn:b,binding:c,once:d}))},once:function(a,b,c){this.on(a,b,c,!0)},emit:function(a){if(a in this._events)for(var b,c=g.call(arguments,1),d=0,e=this._events[a];d<e.length;){b=this._events[a][d];var f=b.fn.apply(b.binding,c);if(f===!1||b.once){for(var h=d;h<e.length;)e[h]=e[++h];e.length--}else d++}},trigger:function(){this.emit.apply(this,arguments)},off:function(a,b){!e.not.string(a)&&a in this._events&&(this._events[a]=this._events[a].filter(function(a){return e["function"](b)&&a.fn!==b}))}}),b.exports=d},{"check-types":2,"node.extend":4}],13:[function(a,b,c){var d=a("check-types");b.exports={alloc:function(a){if(d.not.number(a))throw new Error("Array size should be number.");for(var b=new Array(a),c=0;a>c;c++)b[c]=0;return b},extend:function(a,b){var c=a.length;a.length=c+b;for(var d=c,e=a.length;e>d;d++)a[d]=0;return a},removeAtIndex:function(a,b){var c=a.length;if(0!==c){for(;c>b;)a[b]=a[++b];a.length--}},removeAtIndexConst:function(a,b,c){if(0!==b){for(;b-1>c;)a[c]=a[++c];a[b-1]=0}},indexOf:function(a,b,c){for(var d=0;b>d;d++)if(a[d]===c)return d;return-1},clear:function(a,b){for(var c=0;b>c;c++)a[c]=0},push:function(a,b,c){b===a.length&&this.extend(a,Math.round(1.5*a.length)),a[b]=c}}},{"check-types":2}],14:[function(a,b,c){"use strict";function d(a){g.call(this),this.container=new j,this.engine=new i(this),this.state=new h(this),this.ticker=new k(this),this.plugin=new l(this),this.ticker.on("tick",this.engine.update,this.engine),e.unemptyString(a)&&this.state.change(a)}var e=a("check-types"),f=(a("./debug"),a("node.extend")),g=a("./event"),h=a("./state"),i=a("./engine"),j=a("inverse"),k=a("./ticker"),l=a("./plugin");f(d.prototype,g.prototype),f(d.prototype,{start:function(){var a=this.ticker.start();return a&&this.emit("start"),a},stop:function(a){return a?(this.engine.once("cleared",function(){return this._stopAndEmit()},this),void this.engine.clear()):this._stopAndEmit()},_stopAndEmit:function(){var a=this.ticker.stop();return a&&this.emit("stop"),a},pause:function(){var a=this.ticker.pause();return a&&this.emit("pause"),a},resume:function(){var a=this.ticker.resume();return a&&this.emit("resume"),a}}),b.exports=d},{"./debug":9,"./engine":10,"./event":12,"./plugin":15,"./state":20,"./ticker":21,"check-types":2,inverse:3,"node.extend":4}],15:[function(a,b,c){"use strict";function d(a){h.call(this),this.game=a,this._actualPlugins={},this._actualPluginNames=[],["start","stop","resume","pause"].forEach(function(a){this.game.on(a,function(){this._runPluginMethod(a,arguments)},this)},this),this.game.ticker.on("tick",function(){this._runPluginMethod("update",arguments)},this)}var e=a("check-types"),f=a("./debug"),g=a("node.extend"),h=a("./event"),i=["game","engine","ticker","plugin"];g(d.prototype,h.prototype),g(d.prototype,{add:function(a,b){return-1!==i.indexOf(a)?void f.error("This plugin name is reserved for internal use: %s",a):(this.game[a]=this._actualPlugins[a]=b,this._updateActualPluginNames(),this.emit("pluginAddition",b),b)},remove:function(a){if(!(a in this._actualPlugins))return f.error("Plugin `%s` is not initilized, cannoy be destroyed.",a),!1;var b=this._actualPlugins[a];return e["function"](b.destroy)&&b.destroy(),delete this._actualPlugins[a],delete this.game[a],this._updateActualPluginNames(),this.emit("pluginRemoval",a),!0},_updateActualPluginNames:function(){this._actualPluginNames=Object.keys(this._actualPlugins)},_runPluginMethod:function(a,b){for(var c,d=0;d<this._actualPluginNames.length;d++)c=this._actualPlugins[this._actualPluginNames[d]],e["function"](c[a])&&c[a].apply(c,b)}}),b.exports=d},{"./debug":9,"./event":12,"check-types":2,"node.extend":4}],16:[function(a,b,c){!function(){for(var a=0,b=["ms","moz","webkit","o"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b,c){var d=(new Date).getTime(),e=Math.max(0,16-(d-a)),f=window.setTimeout(function(){b(d+e)},e);return a=d+e,f}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})}(),function(){if("performance"in window==0&&(window.performance={}),Date.now=Date.now||function(){return(new Date).getTime()},"now"in window.performance==0){var a=Date.now();performance.timing&&performance.timing.navigationStart&&(a=performance.timing.navigationStart),window.performance.now=function(){return Date.now()-a}}}()},{}],17:[function(a,b,c){function d(a){this._maxSize=a,this._currentSize=0,this._pool=new Array(a);for(var b=0;a>b;b++)this._pool[b]=0}var e=a("node.extend");e(d.prototype,{put:function(a){if(this._currentSize===this._maxSize){this._maxSize=Math.round(1.5*this._currentSize),this._pool.lenght=this._maxSize;for(var b=this._currentSize+1;b<this._maxSize;b++)this._pool[b]=0}this._pool[this._currentSize++]=a},get:function(){return 0===this._currentSize?null:this._pool[--this._currentSize]},size:function(){return this._currentSize},each:function(a){for(var b=0;b<this._currentSize;b++)a(this._pool[b],b)}}),b.exports=d},{"node.extend":4}],18:[function(a,b,c){"use strict";function d(a){var b,c,d,i=[],k=[];if(e.array(a)?i=a:e.object(a)&&(e.unemptyString(a.name)&&(b=a.name),e.array(a.include)&&(i=a.include),e.array(a.exclude)&&(k=a.exclude)),0===i.length&&0===k.length&&null==b)return void f.warn("You want to create empty query. If your intention is to get all entities, use getAllEntities() instead.");if(i.length>0){c=new j(g("max_component_count"));for(var l=0;l<i.length;l++)c.set(h.getComponentID(i[l]))}if(k){d=new j(g("max_component_count"));for(var m=0;m<k.length;m++)d.set(h.getComponentID(k[l]));
}this.matchName=b,this.includes=c,this.excludes=d}var e=a("check-types"),f=a("./debug"),g=a("./config"),h=a("./register"),i=a("node.extend"),j=a("bitset.js").BitSet;i(d.prototype,{satisfiedBy:function(a){var b=!0,c=this.includes,d=this.excludes,e=this.matchName;return null!=e&&(b=a.pattern.name===e),null!=c&&(b=b&&c.clone().and(a.bitset).equals(c)),null!=d&&(b=b&&d.and(a.bitset).isEmpty()),b}}),b.exports=d},{"./config":7,"./debug":9,"./register":19,"bitset.js":1,"check-types":2,"node.extend":4}],19:[function(a,b,c){"use strict";var d=a("check-types"),e=a("./debug"),f=(a("./config"),!0),g={},h={},i={},j=0;b.exports={registerComponent:function(a){return f?d.not.object(a)?(e.error("component pattern must be an object"),!1):"name"in a&&"initialize"in a?a.name in g?(e.error("you can't define same component twice"),!1):(a._bit=j++,g[a.name.toLowerCase()]=a,!0):(e.error('you must define both "name" and "initialize" of component pattern'),!1):(e.error("you can't define new component during system work"),!1)},registerSystem:function(a){return f?d.object(a)?"name"in a&&"update"in a?a.name in h?(e.error("you can't define same system twice"),!1):(h[a.name]=a,!0):(e.error('you must define both "name" and "update" of system pattern'),!1):(e.error("system pattern must be an object"),!1):(e.error("you can't define new system during system work"),!1)},registerEntity:function(a){return f?d.not.object(a)?(e.error("entity pattern must be an object"),!1):"name"in a&&"create"in a?a.name in i?(e.error("you can't define same entity twice"),!1):(i[a.name]=a,!0):(e.error('you must define both "name" and "create" of entity pattern'),!1):(e.error("you can't define new system during system work"),!1)},listComponentsNames:function(){return Object.keys(g)},listEntitiesNames:function(){return Object.keys(i)},getComponentPattern:function(a){return g[a.toLowerCase()]},getComponentID:function(a){return g[a.toLowerCase()]._bit},getSystemPattern:function(a){return h[a]},getEntityPattern:function(a){return i[a]},canModify:function(){return f},setCannotModify:function(){f=!1}}},{"./config":7,"./debug":9,"check-types":2}],20:[function(a,b,c){"use strict";function d(a){var b=[],c={transitions:{}},d=!1,h=function(){var a=b.shift();if(null==a)return void(d=!1);d=!0;var c=a.fn,e=a.binding,f=a.args||[];f.push(i),c.apply(e,f)},i=function(){h()},j=function(a,b){return c=a,b()},k=function(a,b){return a._initialized=!0,b()},l=function(b,c){return e["function"](b.initialize)?b.initialize(a,c):c()},m=function(b,c){return e["function"](b.enter)?b.enter(a,c):c()},n=function(b){return e["function"](c.exit)?c.exit(a,b):b()},o=function(b,d){var e=f.call(arguments,2);if(b in c.transitions){var g=c[c.transitions[b]];return g.apply(c,[a,d].concat(e))}var h=e.pop();return h()};this.change=function(a){if(!(e.string(a)&&a in g))return void console.warn("State %s does not exists - change will not occur.",a);var c=f.call(arguments,1),i=g[a];return null==i.manager&&(i.manager=this),b.push({fn:n}),i._initialized||(b.push({fn:l,args:[i]}),b.push({fn:k,args:[i]})),b.push({fn:o,args:[a,i].concat(c)}),b.push({fn:m,args:[i]}),b.push({fn:j,args:[i]}),d?void 0:h()},this.current=function(){return c.name},this.isIn=function(a){return a===c.name},this.feed=function(a){return this.register(a)},this.register=function(a){return e.object(a)?("transitions"in a||(a.transitions={}),a._initialized=!1,a.manager=this,g[a.name]=a,this):console.warn("Registered state must be an object.")}}var e=a("check-types"),f=Array.prototype.slice,g=[];d.Register=function(a){return e.object(a)?("transitions"in a||(a.transitions={}),a._initialized=!1,void(g[a.name]=a)):debug.warn("Registered state must be an object.")},b.exports=d},{"check-types":2}],21:[function(a,b,c){(function(c){"use strict";function d(a,b){i.call(this),this.game=a,this.TIME_FACTOR=g("time_factor"),this.MAX_FRAME_TIME=g("max_frame_time"),this._loopVariant=b,this._paused=!1,this._running=!1,this._ticks=0,this._currentFPS=0,this._rafID=0,this._debug=!1}var e=c.requestAnimationFrame,f=a("node.extend"),g=a("./config"),h=a("../lib/stats"),i=a("./event");f(d.prototype,i.prototype),f(d.prototype,{getCurrentFPS:function(){return this._currentFPS},getTicks:function(){return this._ticks},setTimeFactor:function(a){this.TIME_FACTOR=a},pause:function(){return!this.isRunning()||this.isPaused()?!1:(this._paused=!0,this.emit("pause"),!0)},resume:function(){return this.isRunning()&&this.isPaused()?(this._paused=!1,this.emit("resume"),!0):!1},start:function(){function a(f){b._rafID=e(a);var g=performance.now(),h=g-c;b._paused||(b._ticks+=1,h>=b.MAX_FRAME_TIME&&(h=b.MAX_FRAME_TIME),d.delta=h*b.TIME_FACTOR,d.ticks=b._ticks,b._debug&&b._stats.begin(),b.emit("tick",d),b._debug&&b._stats.end())}var b=this;if(this.isPaused())return this.resume();if(this.isRunning())return!1;var c=performance.now(),d={};this._rafID=e(a),this._running=!0,this.emit("start")},stop:function(){return 0===this._rafID?!1:(c.cancelAnimationFrame(this._rafID),this._running=this._paused=!1,this.emit("stop"),!0)},isPaused:function(){return this._paused},isRunning:function(){return this._running},debug:function(a){null==this._stats&&(this._stats=new h),a?(this._stats.domElement.style.position="absolute",this._stats.domElement.style.right="0px",this._stats.domElement.style.top="0px",document.body.appendChild(this._stats.domElement),this._debug=!0):(document.body.removeChild(this._stats.domElement),this._debug=!1)}}),b.exports=d}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../lib/stats":23,"./config":7,"./event":12,"node.extend":4}],22:[function(a,b,c){"use strict";function d(){e.warning("This function should not be used as a constructor.")}a("./core/polyfill");var e=a("./core/debug"),f=a("./core/config"),g=a("./core/state"),h=a("./core/register");console.log.apply(console,["%c %c %c Entropy 0.1.0 - Entity System Framework for JavaScript %c %c ","background: rgb(200, 200,200);","background: rgb(80, 80, 80);","color: white; background: black;","background: rgb(80, 80, 80);","background: rgb(200, 200, 200);"]),d.Component=function(a){h.registerComponent(a)},d.Entity=function(a){h.registerEntity(a)},d.System=function(a){h.registerSystem(a)},d.Const=a("./core/const"),d.Game=a("./core/game"),d.Config=f,d.Query=a("./core/query"),d.State=function(a){g.Register(a)},d.Utils={is:a("check-types"),extend:a("node.extend")},d.EventEmitter=a("./core/event"),b.exports=d},{"./core/config":7,"./core/const":8,"./core/debug":9,"./core/event":12,"./core/game":14,"./core/polyfill":16,"./core/query":18,"./core/register":19,"./core/state":20,"check-types":2,"node.extend":4}],23:[function(a,b,c){var d=function(){var a=Date.now(),b=a,c=0,d=1/0,e=0,f=0,g=1/0,h=0,i=0,j=0,k=document.createElement("div");k.id="stats",k.addEventListener("mousedown",function(a){a.preventDefault(),s(++j%2)},!1),k.style.cssText="width:80px;opacity:0.9;cursor:pointer";var l=document.createElement("div");l.id="fps",l.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#002",k.appendChild(l);var m=document.createElement("div");m.id="fpsText",m.style.cssText="color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",m.innerHTML="FPS",l.appendChild(m);var n=document.createElement("div");for(n.id="fpsGraph",n.style.cssText="position:relative;width:74px;height:30px;background-color:#0ff",l.appendChild(n);74>n.children.length;){var o=document.createElement("span");o.style.cssText="width:1px;height:30px;float:left;background-color:#113",n.appendChild(o)}var p=document.createElement("div");p.id="ms",p.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#020;display:none",k.appendChild(p);var q=document.createElement("div");q.id="msText",q.style.cssText="color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",q.innerHTML="MS",p.appendChild(q);var r=document.createElement("div");for(r.id="msGraph",r.style.cssText="position:relative;width:74px;height:30px;background-color:#0f0",p.appendChild(r);74>r.children.length;)o=document.createElement("span"),o.style.cssText="width:1px;height:30px;float:left;background-color:#131",r.appendChild(o);var s=function(a){switch(j=a){case 0:l.style.display="block",p.style.display="none";break;case 1:l.style.display="none",p.style.display="block"}};return{REVISION:11,domElement:k,setMode:s,begin:function(){a=Date.now()},end:function(){var j=Date.now();c=j-a,d=Math.min(d,c),e=Math.max(e,c),q.textContent=c+" MS ("+d+"-"+e+")";var k=Math.min(30,30-30*(c/200));return r.appendChild(r.firstChild).style.height=k+"px",i++,j>b+1e3&&(f=Math.round(1e3*i/(j-b)),g=Math.min(g,f),h=Math.max(h,f),m.textContent=f+" FPS ("+g+"-"+h+")",k=Math.min(30,30-30*(f/100)),n.appendChild(n.firstChild).style.height=k+"px",b=j,i=0),j},update:function(){a=this.end()}}};"object"==typeof b&&(b.exports=d)},{}]},{},[22])(22)});
//# sourceMappingURL=entropy.map.js