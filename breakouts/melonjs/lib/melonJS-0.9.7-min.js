/**
 * @license MelonJS Game Engine
 * @copyright (C) 2011 - 2013 Olivier Biot, Jason Oster
 * http://www.melonjs.org
 *
 * melonJS is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license.php
 *
 */
var me=me||{};(function(e){function t(){if(!h){if(!r.body)return setTimeout(t,13);r.removeEventListener?r.removeEventListener("DOMContentLoaded",t,!1):e.removeEventListener("load",t,!1),h=!0;for(var i=0;l.length>i;i++)l[i].call(e,[]);l.length=0}}function i(){return a?void 0:(a=!0,"complete"===r.readyState?t():(r.addEventListener&&r.addEventListener("DOMContentLoaded",t,!1),e.addEventListener("load",t,!1),void 0))}function n(){}function s(){o||(me.utils.setNocache(r.location.href.match(/\?nocache/)||!1),me.audio.detectCapabilities(),me.sys.touch="createTouch"in r||"ontouchstart"in e||navigator.isCocoonJS,me.sys.isMobile=me.sys.ua.match(/Android|iPhone|iPad|iPod|BlackBerry|Windows Phone/i),me.timer.init(),me.mapReader=new me.TMXMapReader,me.loadingScreen=new me.DefaultLoadingScreen,me.state.init(),me.entityPool.init(),me.levelDirector.reset(),o=!0)}var r=e.document;me={mod:"melonJS",version:"0.9.7",nocache:"",audio:null,video:null,timer:null,input:null,state:null,game:null,entityPool:null,levelDirector:null,TMXParser:null,loadingScreen:null,TMXTileMap:null},me.sys={ua:navigator.userAgent,sound:!1,localStorage:"object"==typeof e.localStorage,gyro:void 0!==e.DeviceMotionEvent,nativeBase64:"function"==typeof e.atob,touch:!1,isMobile:!1,fps:60,interpolation:!1,scale:null,scalingInterpolation:!1,gravity:void 0,useNativeAnimFrame:!1,cacheImage:!1,dirtyRegion:!1,stopOnAudioError:!0,pauseOnBlur:!0,preRender:!1,checkVersion:function(e,t){t=t||me.version;for(var i=e.split("."),n=t.split("."),s=Math.min(i.length,n.length),r=0,o=0;s>o&&!(r=+i[o]-+n[o]);o++);return r?r:i.length-n.length}};var o=!1,a=!1,h=!1,l=[];e.onReady=function(t){return i(),h?t.call(e,[]):l.push(function(){return t.call(e,[])}),this},e.onReady(function(){s()});var u=!1,c=/var xyz/.test(function(){})?/\bparent\b/:/[\D|\d]*/;Object.extend=function(e){function t(){!u&&this.init&&this.init.apply(this,arguments)}var i=this.prototype;u=!0;var n=new this;u=!1;for(var s in e)n[s]="function"==typeof e[s]&&"function"==typeof i[s]&&c.test(e[s])?function(e,t){return function(){var n=this.parent;this.parent=i[e];var s=t.apply(this,arguments);return this.parent=n,s}}(s,e[s]):e[s];return t.prototype=n,t.constructor=t,t.extend=Object.extend,t},"function"!=typeof Object.create&&(Object.create=function(e){function t(){}return t.prototype=e,new t}),Function.prototype.bind||(Function.prototype.bind=function(e){var t=this;if("function"!=typeof t)throw new TypeError("Function.prototype.bind called on incompatible "+t);var i=Array.prototype.slice.call(arguments,1),s=function(){if(this instanceof s){var n=t.apply(this,i.concat(Array.prototype.slice.call(arguments)));return Object(n)===n?n:this}return t.apply(e,i.concat(Array.prototype.slice.call(arguments)))};return t.prototype&&(n.prototype=t.prototype,s.prototype=new n,n.prototype=null),s}),Date.now===void 0&&(Date.now=function(){return(new Date).getTime()}),"undefined"==typeof console&&(console={log:function(){},info:function(){},error:function(){alert(Array.prototype.slice.call(arguments).join(", "))}}),Function.prototype.defer=function(){var e=this,t=Array.prototype.slice.call(arguments);return window.setTimeout(function(){return e.apply(e,t)},.01)},Object.defineProperty||(Object.defineProperty=function(e,t,i){if(!e.__defineGetter__)throw"melonJS: Object.defineProperty not supported";i.get&&e.__defineGetter__(t,i.get),i.set&&e.__defineSetter__(t,i.set)}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")}),String.prototype.isNumeric=function(){return null!==this&&!isNaN(this)&&""!==this.trim()},String.prototype.isBoolean=function(){return null!==this&&("true"===this.trim()||"false"===this.trim())},String.prototype.contains=function(e){return this.indexOf(e)>-1},String.prototype.toHex=function(){for(var e="",t=0;this.length>t;)e+=this.charCodeAt(t++).toString(16);return e},Number.prototype.clamp=function(e,t){return e>this?e:this>t?t:+this},Number.prototype.random=function(e,t){return~~(Math.random()*(t-e+1))+e},Number.prototype.round=function(){var e=2>arguments.length?this:arguments[0],t=Math.pow(10,arguments[1]||arguments[0]||0);return Math.round(e*t)/t},Number.prototype.toHex=function(){return"0123456789ABCDEF".charAt(this-this%16>>4)+"0123456789ABCDEF".charAt(this%16)},Number.prototype.sign=function(){return 0>this?-1:this>0?1:0},Number.prototype.degToRad=function(e){return(e||this)/180*Math.PI},Number.prototype.radToDeg=function(e){return(e||this)*(180/Math.PI)},Array.prototype.remove=function(e){var t=Array.prototype.indexOf.call(this,e);return-1!==t&&Array.prototype.splice.call(this,t,1),this},Array.prototype.forEach||(Array.prototype.forEach=function(e,t){for(var i=0,n=this.length;n--;i++)e.call(t||this,this[i],i,this)}),Object.defineProperty(me,"initialized",{get:function(){return o}});var m=function(){var e,t={},i=[],n=[],s=0;return t.isDirty=!1,t.reset=function(){i.length=0,n.length=0,e=me.game.viewport.getRect(),t.makeAllDirty()},t.makeDirty=function(e,s,r){s&&(t.isDirty=!0,me.sys.dirtyRegion&&(r?i.push(r.union(e)):e.getRect&&i.push(e.getRect()))),e.inViewport&&n.unshift(e)},t.makeAllDirty=function(){i.length=0,i.push(e),t.isDirty=!0},t.remove=function(e){var i=n.indexOf(e);-1!==i&&(n.splice(i,1),e.inViewport=!1,t.makeDirty(e,!0))},t.getDrawCount=function(){return s},t.draw=function(e){var t=me.game.viewport.pos.x+~~me.game.viewport.offset.x,r=me.game.viewport.pos.y+~~me.game.viewport.offset.y;e.save(),e.translate(-t,-r),t-=me.game.currentLevel.pos.x,r-=me.game.currentLevel.pos.y;for(var o,a=i.length;a--,o=i[a];){for(var h,l=n.length;l--,h=n[l];)me.sys.dirtyRegion&&h.isSprite&&!h.overlaps(o)||(h.floating===!0&&(e.save(),e.translate(t,r)),h.draw(e,o),h.floating===!0&&e.restore(),s++);me.debug.renderDirty&&o.draw(e,"white")}e.restore()},t.flush=function(){me.sys.dirtyRegion&&(i.length=0),n.length=0,t.isDirty=!1,s=0},t}();me.game=function(){var e={},t=null,i=[],n=!1,s=null,r=null,o=function(e,t){return t.z-e.z};return e.viewport=null,e.HUD=null,e.collisionMap=null,e.currentLevel=null,e.renderer=null,e.NO_OBJECT=0,e.ENEMY_OBJECT=1,e.COLLECTABLE_OBJECT=2,e.ACTION_OBJECT=3,e.onLevelLoaded=null,e.init=function(i,s){if(!n){var i=i||me.video.getWidth(),s=s||me.video.getHeight();e.viewport=new me.Viewport(0,0,i,s),t=me.video.getSystemContext(),me.event.publish(me.event.GAME_INIT),n=!0}},e.reset=function(){n||e.init(),e.removeAll(!0),e.viewport&&e.viewport.reset(),m.reset(),t.setTransform(1,0,0,1,0,0),e.currentLevel={pos:{x:0,y:0}}},e.loadTMXLevel=function(i){e.currentLevel=i,e.collisionMap=e.currentLevel.getLayerByName("collision"),e.collisionMap&&e.collisionMap.isCollisionMap||console.error("WARNING : no collision map detected");for(var n=e.currentLevel.getLayers(),s=n.length;s--;)n[s].visible&&e.add(n[s]);e.viewport.setBounds(Math.max(e.currentLevel.width,e.viewport.width),Math.max(e.currentLevel.height,e.viewport.height));for(var r=e.currentLevel.getObjectGroups(),o=0;r.length>o;o++)if(r[o].visible)for(var a=0;r[o].objects.length>a;a++)e.addEntity(r[o].objects[a],r[o].z);e.currentLevel.pos.x!==e.currentLevel.pos.y&&t.translate(e.currentLevel.pos.x,e.currentLevel.pos.y),e.sort(),e.onLevelLoaded&&e.onLevelLoaded.call(e.onLevelLoaded,i.name),me.event.publish(me.event.LEVEL_LOADED,[i.name])},e.add=function(e,t){e.z=t?t:e.z,i.push(e)},e.addEntity=function(t,i){var n=me.entityPool.newInstanceOf(t.name,t.x,t.y,t);n&&e.add(n,i)},e.getEntityByName=function(e){var t=[];e=e.toLowerCase();for(var n,s=i.length;s--,n=i[s];)n.name&&n.name.toLowerCase()===e&&t.push(n);return t},e.getObjectCount=function(){return i.length},e.getDrawCount=function(){return m.getDrawCount()},e.getEntityByGUID=function(e){for(var t,n=i.length;n--,t=i[n];)if(t.isEntity&&t.GUID==e)return t;return null},e.getEntityByProp=function(e,t){for(var n,s=[],r=i.length;r--,n=i[r];)n.isEntity&&n[e]==t&&s.push(n);return s},e.addHUD=function(t,i,n,s,r){null==e.HUD&&(e.HUD=new me.HUD_Object(t,i,n,s,r),e.add(e.HUD))},e.disableHUD=function(){null!=e.HUD&&(e.remove(e.HUD),e.HUD=null)},e.update=function(){for(var t,n=null,s=i.length;s--,t=i[s];){n=me.sys.dirtyRegion&&t.isSprite?t.getRect():null,t.inViewport=t.visible&&(t.floating||t.getRect&&e.viewport.isVisible(t));var r=(t.inViewport||t.alwaysUpdate)&&t.update();m.makeDirty(t,r,r?n:null)}e.viewport.update(m.isDirty)&&m.makeAllDirty()},e.remove=function(e,t){function n(e){e.destroy&&e.destroy(),m.remove(e),i.remove(e),me.entityPool.freeInstance(e)}i.indexOf(e)>-1&&(t===!0?n(e):(e.visible=!1,s=function(e){n(e),s=null}.defer(e)))},e.removeAll=function(t){s&&(clearTimeout(s),s=null),r&&(clearTimeout(r),r=null);for(var n=i.length;n--;)i[n].isPersistent||e.remove(i[n],t);t===!0&&m.flush()},e.sort=function(e){null===r&&("function"!=typeof e&&(e=o),r=function(e){i.sort(e),r=null,me.game.repaint()}.defer(e))},e.collide=function(e,t){var n;if(t=t===!0?!0:!1,t===!0)var s=[],r=0;for(var o,a=i.length;a--,o=i[a];)if((o.inViewport||o.alwaysUpdate)&&o.collidable&&o!=e&&(n=o.collisionBox.collideVsAABB.call(o.collisionBox,e.collisionBox),0!=n.x||0!=n.y)){if(o.onCollision.call(o,n,e),n.type=o.type,n.obj=o,!t)return n;s[r++]=n}return t?s:null},e.collideType=function(e,t,n){var s;if(n=n===!0?!0:!1,n===!0)var r=[],o=0;for(var a,h=i.length;h--,a=i[h];)if((a.inViewport||a.alwaysUpdate)&&a.collidable&&a.type===t&&a!=e&&(s=a.collisionBox.collideVsAABB.call(a.collisionBox,e.collisionBox),0!=s.x||0!=s.y)){if(a.onCollision.call(a,s,e),s.type=a.type,s.obj=a,!n)return s;r[o++]=s}return n?r:null},e.repaint=function(){m.makeAllDirty()},e.draw=function(){m.isDirty&&(m.draw(t),e.viewport.draw(t)),m.flush()},e}()})(window),function(){me.Vector2d=Object.extend({x:0,y:0,init:function(e,t){this.x=e||0,this.y=t||0},set:function(e,t){return this.x=e,this.y=t,this},setZero:function(){return this.set(0,0)},setV:function(e){return this.x=e.x,this.y=e.y,this},add:function(e){return this.x+=e.x,this.y+=e.y,this},sub:function(e){return this.x-=e.x,this.y-=e.y,this},scale:function(e){return this.x*=e.x,this.y*=e.y,this},div:function(e){return this.x/=e,this.y/=e,this},abs:function(){return 0>this.x&&(this.x=-this.x),0>this.y&&(this.y=-this.y),this},clamp:function(e,t){return new me.Vector2d(this.x.clamp(e,t),this.y.clamp(e,t))},clampSelf:function(e,t){return this.x=this.x.clamp(e,t),this.y=this.y.clamp(e,t),this},minV:function(e){return this.x=this.x<e.x?this.x:e.x,this.y=this.y<e.y?this.y:e.y,this},maxV:function(e){return this.x=this.x>e.x?this.x:e.x,this.y=this.y>e.y?this.y:e.y,this},floor:function(){return new me.Vector2d(~~this.x,~~this.y)},floorSelf:function(){return this.x=~~this.x,this.y=~~this.y,this},ceil:function(){return new me.Vector2d(Math.ceil(this.x),Math.ceil(this.y))},ceilSelf:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},negate:function(){return new me.Vector2d(-this.x,-this.y)},negateSelf:function(){return this.x=-this.x,this.y=-this.y,this},copy:function(e){return this.x=e.x,this.y=e.y,this},equals:function(e){return this.x===e.x&&this.y===e.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){var e=this.length();if(Number.MIN_VALUE>e)return 0;var t=1/e;return this.x*=t,this.y*=t,e},dotProduct:function(e){return this.x*e.x+this.y*e.y},distance:function(e){return Math.sqrt((this.x-e.x)*(this.x-e.x)+(this.y-e.y)*(this.y-e.y))},angle:function(e){return Math.atan2(e.y-this.y,e.x-this.x)},clone:function(){return new me.Vector2d(this.x,this.y)},toString:function(){return"x:"+this.x+",y:"+this.y}}),me.Rect=Object.extend({pos:null,colPos:null,anchorPoint:null,width:0,height:0,hWidth:0,hHeight:0,init:function(e,t,i){this.pos=e,this.colPos=new me.Vector2d,this.width=t,this.height=i,this.hWidth=~~(t/2),this.hHeight=~~(i/2),this.anchorPoint=new me.Vector2d(.5,.5),Object.defineProperty(this,"left",{get:function(){return this.pos.x},configurable:!0}),Object.defineProperty(this,"right",{get:function(){return this.pos.x+this.width},configurable:!0}),Object.defineProperty(this,"top",{get:function(){return this.pos.y},configurable:!0}),Object.defineProperty(this,"bottom",{get:function(){return this.pos.y+this.height},configurable:!0})},set:function(e,t,i){this.pos=e,this.width=t,this.height=i,this.hWidth=~~(t/2),this.hHeight=~~(i/2)},getRect:function(){return new me.Rect(this.pos.clone(),this.width,this.height)},translate:function(e,t){return this.pos.x+=e,this.pos.y+=t,this},translateV:function(e){return this.pos.add(e),this},union:function(e){var t=Math.min(this.pos.x,e.pos.x),i=Math.min(this.pos.y,e.pos.y);return this.width=Math.ceil(Math.max(this.pos.x+this.width,e.pos.x+e.width)-t),this.height=Math.ceil(Math.max(this.pos.y+this.height,e.pos.y+e.height)-i),this.pos.x=~~t,this.pos.y=~~i,this},adjustSize:function(e,t,i,n){-1!=e&&(this.colPos.x=e,this.width=t,this.hWidth=~~(this.width/2),this.left!==this.pos.x+this.colPos.x&&Object.defineProperty(this,"left",{get:function(){return this.pos.x+this.colPos.x},configurable:!0}),this.right!==this.pos.x+this.colPos.x+this.width&&Object.defineProperty(this,"right",{get:function(){return this.pos.x+this.colPos.x+this.width},configurable:!0})),-1!=i&&(this.colPos.y=i,this.height=n,this.hHeight=~~(this.height/2),this.top!==this.pos.y+this.colPos.y&&Object.defineProperty(this,"top",{get:function(){return this.pos.y+this.colPos.y},configurable:!0}),this.bottom!==this.pos.y+this.colPos.y+this.height&&Object.defineProperty(this,"bottom",{get:function(){return this.pos.y+this.colPos.y+this.height},configurable:!0}))},flipX:function(e){this.colPos.x=e-this.width-this.colPos.x,this.hWidth=~~(this.width/2)},flipY:function(e){this.colPos.y=e-this.height-this.colPos.y,this.hHeight=~~(this.height/2)},equals:function(e){return this.left===e.left&&this.right===e.right&&this.top===e.top&&this.bottom===e.bottom},overlaps:function(e){return this.left<e.right&&e.left<this.right&&this.top<e.bottom&&e.top<this.bottom},within:function(e){return e.left<=this.left&&e.right>=this.right&&e.top<=this.top&&e.bottom>=this.bottom},contains:function(e){return e.left>=this.left&&e.right<=this.right&&e.top>=this.top&&e.bottom<=this.bottom},containsPoint:function(e){return e.x>=this.left&&e.x<=this.right&&e.y>=this.top&&e.y<=this.bottom},collideVsAABB:function(e){var t=new me.Vector2d(0,0);if(this.overlaps(e)){var i=this.left+this.hWidth-e.left-e.hWidth,n=this.top+this.hHeight-e.top-e.hHeight;t.x=e.hWidth+this.hWidth-(0>i?-i:i),t.y=e.hHeight+this.hHeight-(0>n?-n:n),t.x<t.y?(t.y=0,t.x=0>i?-t.x:t.x):(t.x=0,t.y=0>n?-t.y:t.y)}return t},draw:function(e,t){e.strokeStyle=t||"red",e.strokeRect(this.left,this.top,this.width,this.height)}})}(window),function(){me.debug={displayFPS:!1,renderHitBox:!1,renderCollisionMap:!1,renderDirty:!1,renderVelocity:!1}}(window),function(){me.Renderable=me.Rect.extend({isRenderable:!0,visible:!0,inViewport:!1,alwaysUpdate:!1,isPersistent:!1,floating:!1,init:function(e,t,i){this.parent(e,t,i)},update:function(){return!1},draw:function(e,t){this.parent(e,t)}})}(window),function(){me.SpriteObject=me.Renderable.extend({scale:null,scaleFlag:!1,lastflipX:!1,lastflipY:!1,z:0,offset:null,angle:0,_sourceAngle:0,alpha:1,image:null,flickering:!1,flickerTimer:-1,flickercb:null,flickerState:!1,init:function(e,t,i,n,s){this.isSprite=!0,this.parent(new me.Vector2d(e,t),n||i.width,s||i.height),this.image=i,this.scale=new me.Vector2d(1,1),this.lastflipX=this.lastflipY=!1,this.scaleFlag=!1,this.offset=new me.Vector2d(0,0),this.alpha=1,this.visible=!0,this.isPersistent=!1,this.flickering=!1},setTransparency:function(e){e="#"==e.charAt(0)?e.substring(1,7):e,this.image=me.video.applyRGBFilter(this.image,"transparent",e.toUpperCase()).canvas},isFlickering:function(){return this.flickering},flicker:function(e,t){this.flickerTimer=e,0>this.flickerTimer?(this.flickering=!1,this.flickercb=null):this.flickering||(this.flickercb=t,this.flickering=!0)},flipX:function(e){e!=this.lastflipX&&(this.lastflipX=e,this.scale.x=-this.scale.x,this.scaleFlag=1!=this.scale.x||1!=this.scale.y)},flipY:function(e){e!=this.lastflipY&&(this.lastflipY=e,this.scale.y=-this.scale.y,this.scaleFlag=1!=this.scale.x||1!=this.scale.y)},resize:function(e){e>0&&(this.scale.x=0>this.scale.x?-e:e,this.scale.y=0>this.scale.y?-e:e,this.scaleFlag=1!=this.scale.x||1!=this.scale.y)},getOpacity:function(){return this.alpha},setOpacity:function(e){"number"==typeof e&&(this.alpha=e.clamp(0,1))},update:function(){return this.flickering?(this.flickerTimer-=me.timer.tick,0>this.flickerTimer&&(this.flickercb&&this.flickercb(),this.flicker(-1)),!0):!1},draw:function(e){if(!this.flickering||(this.flickerState=!this.flickerState,this.flickerState)){e.save(),e.globalAlpha=this.alpha;var t=~~this.pos.x,i=~~this.pos.y,n=this.width,s=this.height,r=this.angle+this._sourceAngle;if(this.scaleFlag||0!==r){var o=n*this.anchorPoint.x,a=s*this.anchorPoint.y;e.translate(t+o,i+a),this.scaleFlag&&e.scale(this.scale.x,this.scale.y),0!==r&&e.rotate(r),0!==this._sourceAngle?(n=this.height,s=this.width,t=-a,i=-o):(t=-o,i=-a)}e.drawImage(this.image,this.offset.x,this.offset.y,n,s,t,i,n,s),e.restore(),me.debug.renderHitBox&&this.parent(e,"green")}},destroy:function(){this.onDestroyEvent.apply(this,arguments)},onDestroyEvent:function(){}}),me.AnimationSheet=me.SpriteObject.extend({fpscount:0,spacing:0,margin:0,animationpause:!1,animationspeed:0,init:function(e,t,i,n,s,r,o,a,h){this.anim=[],this.resetAnim=null,this.current=null,this.animationspeed=me.sys.fps/10,this.spacing=r||0,this.margin=o||0,this.parent(e,t,i,n,s,r,o),this.textureAtlas=null,this.atlasIndices=null,this.buildLocalAtlas(a||void 0,h||void 0),this.addAnimation("default",null),this.setCurrentAnimation("default")},buildLocalAtlas:function(e,t){if(void 0!==e)this.textureAtlas=e,this.atlasIndices=t;else{this.textureAtlas=[];for(var i=new me.Vector2d(~~((this.image.width-this.margin)/(this.width+this.spacing)),~~((this.image.height-this.margin)/(this.height+this.spacing))),n=0,s=i.x*i.y;s>n;n++)this.textureAtlas[n]={name:""+n,offset:new me.Vector2d(this.margin+(this.spacing+this.width)*(n%i.x),this.margin+(this.spacing+this.height)*~~(n/i.x)),width:this.width,height:this.height,angle:0}}},addAnimation:function(e,t,i){if(this.anim[e]={name:e,frame:[],idx:0,length:0,animationspeed:i||this.animationspeed},null==t){t=[];var n=0;this.textureAtlas.forEach(function(){t[n]=n++})}for(var n=0,s=t.length;s>n;n++)if("number"==typeof t[n])this.anim[e].frame[n]=this.textureAtlas[t[n]];else{if(null===this.atlasIndices)throw"melonjs: string parameters for addAnimation are only allowed for TextureAtlas ";this.anim[e].frame[n]=this.textureAtlas[this.atlasIndices[t[n]]]}this.anim[e].length=this.anim[e].frame.length},setCurrentAnimation:function(e,t){if(!this.anim[e])throw"melonJS: animation id '"+e+"' not defined";this.current=this.anim[e],this.resetAnim=t||null,this.setAnimationFrame(this.current.idx)},isCurrentAnimation:function(e){return this.current.name==e},setAnimationFrame:function(e){this.current.idx=(e||0)%this.current.length;var t=this.current.frame[this.current.idx];this.offset=t.offset,this.width=t.width,this.height=t.height,this._sourceAngle=t.angle},getCurrentAnimationFrame:function(){return this.current.idx},update:function(){return!this.animationpause&&this.fpscount++>this.current.animationspeed?(this.setAnimationFrame(++this.current.idx),this.fpscount=0,0==this.current.idx&&this.resetAnim&&("string"==typeof this.resetAnim?this.setCurrentAnimation(this.resetAnim):"function"==typeof this.resetAnim&&this.resetAnim()),this.parent()||!0):this.parent()}})}(window),function(){var e=-(Math.PI/2);me.TextureAtlas=Object.extend({format:null,texture:null,atlas:null,init:function(e,t){if(e&&e.meta&&e.meta.app.contains("texturepacker")){if(this.format="texturepacker",void 0===t){var i=me.utils.getBasename(e.meta.image);if(this.texture=me.loader.getImage(i),null===this.texture)throw"melonjs: Atlas texture '"+i+"' not found"}else this.texture=t;this.atlas=this.initFromTexturePacker(e)}if(null===this.atlas)throw"melonjs: texture atlas format not supported"},initFromTexturePacker:function(e){var t={};return e.frames.forEach(function(e){t[e.filename]={frame:new me.Rect(new me.Vector2d(e.frame.x,e.frame.y),e.frame.w,e.frame.h),source:new me.Rect(new me.Vector2d(e.spriteSourceSize.x,e.spriteSourceSize.y),e.spriteSourceSize.w,e.spriteSourceSize.h),rotated:e.rotated===!0,trimmed:e.trimmed===!0}}),t},getTexture:function(){return this.texture},getRegion:function(t){var i=this.atlas[t];return i?{name:t,pos:i.source.pos.clone(),offset:i.frame.pos.clone(),width:i.frame.width,height:i.frame.height,angle:i.rotated===!0?e:0}:null},createSpriteFromName:function(e){var t=this.getRegion(e);if(t){var i=new me.SpriteObject(0,0,this.getTexture(),t.width,t.height);return i.offset.setV(t.offset),i._sourceAngle=t.angle,i}throw"melonjs: TextureAtlas - region for "+e+" not found"},createAnimationFromName:function(e){for(var t=[],i={},n=0;e.length>n;++n)if(t[n]=this.getRegion(e[n]),i[e[n]]=n,null==t[n])throw"melonjs: TextureAtlas - region for "+e[n]+" not found";return new me.AnimationSheet(0,0,this.texture,0,0,0,0,t,i)}})}(window),function(){var e=Math.min,t=Math.max;me.Viewport=me.Rect.extend({AXIS:{NONE:0,HORIZONTAL:1,VERTICAL:2,BOTH:3},limits:null,target:null,follow_axis:0,shaking:!1,_shake:null,_fadeIn:null,_fadeOut:null,_deadwidth:0,_deadheight:0,_limitwidth:0,_limitheight:0,init:function(e,t,i,n,s,r){this.parent(new me.Vector2d(e,t),i-e,n-t),this.limits=new me.Vector2d(s||this.width,r||this.height),this.offset=new me.Vector2d,this.target=null,this.follow_axis=this.AXIS.NONE,this._shake={intensity:0,duration:0,axis:this.AXIS.BOTH,onComplete:null,start:0},this._fadeOut={color:0,alpha:0,duration:0,tween:null},this._fadeIn={color:0,alpha:1,duration:0,tween:null},this.setDeadzone(this.width/6,this.height/6)},_followH:function(i){return i.x-this.pos.x>this._deadwidth?(this.pos.x=~~e(i.x-this._deadwidth,this._limitwidth),!0):i.x-this.pos.x<this.deadzone.x?(this.pos.x=~~t(i.x-this.deadzone.x,0),!0):!1},_followV:function(i){return i.y-this.pos.y>this._deadheight?(this.pos.y=~~e(i.y-this._deadheight,this._limitheight),!0):i.y-this.pos.y<this.deadzone.y?(this.pos.y=~~t(i.y-this.deadzone.y,0),!0):!1},reset:function(e,t){this.pos.x=e||0,this.pos.y=t||0,this.target=null,this.follow_axis=null},setDeadzone:function(e,t){this.deadzone=new me.Vector2d(~~((this.width-e)/2),~~((this.height-t)/2-.25*t)),this._deadwidth=this.width-this.deadzone.x,this._deadheight=this.height-this.deadzone.y,this.update(!0)},setBounds:function(e,t){this.limits.set(e,t),this._limitwidth=this.limits.x-this.width,this._limitheight=this.limits.y-this.height},follow:function(e,t){if(e instanceof me.ObjectEntity)this.target=e.pos;else{if(!(e instanceof me.Vector2d))throw"melonJS: invalid target for viewport.follow";this.target=e}this.follow_axis=t||this.AXIS.BOTH,this.update(!0)},move:function(e,t){var i=~~(this.pos.x+e),n=~~(this.pos.y+t);this.pos.x=i.clamp(0,this._limitwidth),this.pos.y=n.clamp(0,this._limitheight)},update:function(e){if(this.target&&e)switch(this.follow_axis){case this.AXIS.NONE:break;case this.AXIS.HORIZONTAL:e=this._followH(this.target);break;case this.AXIS.VERTICAL:e=this._followV(this.target);break;case this.AXIS.BOTH:e=this._followH(this.target),e=this._followV(this.target)||e;break;default:}if(this.shaking){var t=me.timer.getTime()-this._shake.start;t>=this._shake.duration?(this.shaking=!1,this.offset.setZero(),"function"==typeof this._shake.onComplete&&this._shake.onComplete()):((this._shake.axis==this.AXIS.BOTH||this._shake.axis==this.AXIS.HORIZONTAL)&&(this.offset.x=(Math.random()-.5)*this._shake.intensity),(this._shake.axis==this.AXIS.BOTH||this._shake.axis==this.AXIS.VERTICAL)&&(this.offset.y=(Math.random()-.5)*this._shake.intensity)),e=!0}return(null!=this._fadeIn.tween||null!=this._fadeOut.tween)&&(e=!0),e},shake:function(e,t,i,n){this.shaking||(this.shaking=!0,this._shake={intensity:e,duration:t,axis:i||this.AXIS.BOTH,onComplete:n||null,start:me.timer.getTime()})},fadeOut:function(e,t,i){this._fadeOut.color=e,this._fadeOut.duration=t||1e3,this._fadeOut.alpha=1,this._fadeOut.tween=new me.Tween(this._fadeOut).to({alpha:0},this._fadeOut.duration).onComplete(i||null),this._fadeOut.tween.start()},fadeIn:function(e,t,i){this._fadeIn.color=e,this._fadeIn.duration=t||1e3,this._fadeIn.alpha=0,this._fadeIn.tween=new me.Tween(this._fadeIn).to({alpha:1},this._fadeIn.duration).onComplete(i||null),this._fadeIn.tween.start()},getWidth:function(){return this.width},getHeight:function(){return this.height},focusOn:function(e){this.pos.x=e.x-.5*this.width,this.pos.y=e.y-.5*this.height},isVisible:function(e){return e.overlaps(this)},draw:function(e){this._fadeIn.tween&&(e.globalAlpha=this._fadeIn.alpha,me.video.clearSurface(e,me.utils.HexToRGB(this._fadeIn.color)),e.globalAlpha=1,1==this._fadeIn.alpha&&(this._fadeIn.tween=null)),this._fadeOut.tween&&(e.globalAlpha=this._fadeOut.alpha,me.video.clearSurface(e,me.utils.HexToRGB(this._fadeOut.color)),e.globalAlpha=1,0==this._fadeOut.alpha&&(this._fadeOut.tween=null))}})}(window),function(){me.ObjectSettings={name:null,image:null,transparent_color:null,spritewidth:null,spriteheight:null,type:0,collidable:!0},me.entityPool=function(){var e={},t={};return e.init=function(){e.add("me.ObjectEntity",me.ObjectEntity),e.add("me.CollectableEntity",me.CollectableEntity),e.add("me.LevelEntity",me.LevelEntity)},e.add=function(e,i,n){return n?(t[e.toLowerCase()]={"class":i,pool:[],active:[]},void 0):(t[e.toLowerCase()]=i,void 0)},e.newInstanceOf=function(e){var i="string"==typeof e?e.toLowerCase():void 0;if(i&&t[i]){if(!t[i].pool){var n=t[i];return arguments[0]=n,new(n.bind.apply(n,arguments))}var s,r=t[i],n=r["class"];return r.pool.length>0?(s=r.pool.pop(),s.init.apply(s,Array.prototype.slice.call(arguments,1))):(arguments[0]=n,s=new(n.bind.apply(n,arguments)),s.className=i),r.active.push(s),s}var o=arguments[3];return o&&o.image?new me.SpriteObject(o.x,o.y,o.image):(i&&console.error("Cannot instantiate entity of type '"+e+"': Class not found!"),null)},e.purge=function(){for(className in t)t[className].pool=[]},e.freeInstance=function(e){var i=e.className;if(i&&t[i]){for(var n=!0,s=0,r=t[i].active.length;r>s;s++)if(t[i].active[s]===e){n=!1,t[i].active.splice(s,1);break}n||t[i].pool.push(e)}},e}(),me.ObjectEntity=me.Renderable.extend({GUID:null,type:0,collidable:!0,collisionBox:null,renderable:null,z:0,init:function(e,t,i){if(this.parent(new me.Vector2d(e,t),~~i.spritewidth||~~i.width,~~i.spriteheight||~~i.height),i.image){var n="string"==typeof i.image?me.loader.getImage(i.image):i.image;this.renderable=new me.AnimationSheet(0,0,n,~~i.spritewidth,~~i.spriteheight,~~i.spacing,~~i.margin),i.transparent_color&&this.renderable.setTransparency(i.transparent_color)}this.GUID=me.utils.createGUID(),this.name=i.name?i.name.toLowerCase():"",this.vel=new me.Vector2d,this.accel=new me.Vector2d,this.friction=new me.Vector2d,this.maxVel=new me.Vector2d(1e3,1e3),this.gravity=void 0!=me.sys.gravity?me.sys.gravity:.98,this.isEntity=!0,this.alive=!0,this.visible=!0,this.floating=!1,this.isPersistent=!1,this.falling=!1,this.jumping=!0,this.slopeY=0,this.onslope=!1,this.onladder=!1,this.disableTopLadderCollision=!1,this.collidable=i.collidable!==void 0?i.collidable:!0,this.type=i.type||0,this.collisionMap=me.game.collisionMap,this.collisionBox=new me.Rect(this.pos,this.width,this.height),this.canBreakTile=!1,this.onTileBreak=null},updateColRect:function(e,t,i,n){this.collisionBox.adjustSize(e,t,i,n)},onCollision:function(){this.collidable&&this.type==me.game.COLLECTABLE_OBJECT&&me.game.remove(this)},setVelocity:function(e,t){this.accel.x=0!=e?e:this.accel.x,this.accel.y=0!=t?t:this.accel.y,this.setMaxVelocity(e,t)},setMaxVelocity:function(e,t){this.maxVel.x=e,this.maxVel.y=t},setFriction:function(e,t){this.friction.x=e||0,this.friction.y=t||0},flipX:function(e){e!=this.lastflipX&&(this.renderable&&this.renderable.flipX(e),this.collisionBox.flipX(this.width))},flipY:function(e){e!=this.lastflipY&&(this.renderable&&this.renderable.flipY(e),this.collisionBox.flipY(this.height))},doWalk:function(e){this.flipX(e),this.vel.x+=e?-this.accel.x*me.timer.tick:this.accel.x*me.timer.tick},doClimb:function(e){return this.onladder?(this.vel.y=e?-this.accel.x*me.timer.tick:this.accel.x*me.timer.tick,this.disableTopLadderCollision=!e,!0):!1},doJump:function(){return this.jumping||this.falling?!1:(this.vel.y=-this.maxVel.y*me.timer.tick,this.jumping=!0,!0)},forceJump:function(){this.jumping=this.falling=!1,this.doJump()},distanceTo:function(e){var t=this.pos.x+this.hWidth-(e.pos.x+e.hWidth),i=this.pos.y+this.hHeight-(e.pos.y+e.hHeight);return Math.sqrt(t*t+i*i)},distanceToPoint:function(e){var t=this.pos.x+this.hWidth-e.x,i=this.pos.y+this.hHeight-e.y;return Math.sqrt(t*t+i*i)},angleTo:function(e){var t=e.pos.x+e.hWidth-(this.pos.x+this.hWidth),i=e.pos.y+e.hHeight-(this.pos.y+this.hHeight);return Math.atan2(i,t)},angleToPoint:function(e){var t=e.x-(this.pos.x+this.hWidth),i=e.y-(this.pos.y+this.hHeight);return Math.atan2(i,t)},checkSlope:function(e,t){this.pos.y=e.pos.y-this.height,this.slopeY=t?e.height-(this.collisionBox.right+this.vel.x-e.pos.x):this.collisionBox.left+this.vel.x-e.pos.x,this.vel.y=0,this.pos.y+=this.slopeY.clamp(0,e.height)},computeVelocity:function(e){this.gravity&&(e.y+=this.onladder?0:this.gravity*me.timer.tick,this.falling=e.y>0,this.jumping=this.falling?!1:this.jumping),this.friction.x&&(e.x=me.utils.applyFriction(e.x,this.friction.x)),this.friction.y&&(e.y=me.utils.applyFriction(e.y,this.friction.y)),0!=e.y&&(e.y=e.y.clamp(-this.maxVel.y,this.maxVel.y)),0!=e.x&&(e.x=e.x.clamp(-this.maxVel.x,this.maxVel.x))},updateMovement:function(){if(this.computeVelocity(this.vel),this.collidable){var e=this.collisionMap.checkCollision(this.collisionBox,this.vel);this.onslope=e.yprop.isSlope||e.xprop.isSlope,this.onladder=!1,e.y&&(this.onladder=e.yprop.isLadder||e.yprop.isTopLadder,e.y>0?e.yprop.isSolid||e.yprop.isPlatform&&this.collisionBox.bottom-1<=e.ytile.pos.y||e.yprop.isTopLadder&&!this.disableTopLadderCollision?(this.pos.y=~~this.pos.y,this.vel.y=this.falling?e.ytile.pos.y-this.collisionBox.bottom:0,this.falling=!1):e.yprop.isSlope&&!this.jumping?(this.checkSlope(e.ytile,e.yprop.isLeftSlope),this.falling=!1):e.yprop.isBreakable&&(this.canBreakTile?(me.game.currentLevel.clearTile(e.ytile.col,e.ytile.row),this.onTileBreak&&this.onTileBreak()):(this.pos.y=~~this.pos.y,this.vel.y=this.falling?e.ytile.pos.y-this.collisionBox.bottom:0,this.falling=!1)):0>e.y&&(e.yprop.isPlatform||e.yprop.isLadder||e.yprop.isTopLadder||(this.falling=!0,this.vel.y=0))),e.x&&(this.onladder=e.xprop.isLadder||e.yprop.isTopLadder,e.xprop.isSlope&&!this.jumping?(this.checkSlope(e.xtile,e.xprop.isLeftSlope),this.falling=!1):e.xprop.isPlatform||e.xprop.isLadder||e.xprop.isTopLadder||(e.xprop.isBreakable&&this.canBreakTile?(me.game.currentLevel.clearTile(e.xtile.col,e.xtile.row),this.onTileBreak&&this.onTileBreak()):this.vel.x=0))}return this.pos.add(this.vel),e},collide:function(e){return me.game.collide(this,e||!1)},collideType:function(e,t){return me.game.collideType(this,e,t||!1)},update:function(){return this.renderable?this.renderable.update():!1},getRect:function(){return this.renderable?this.renderable.getRect().translateV(this.pos):null},draw:function(e){if(this.renderable){var t=~~(this.pos.x+this.anchorPoint.x*(this.width-this.renderable.width)),i=~~(this.pos.y+this.anchorPoint.y*(this.height-this.renderable.height));e.translate(t,i),this.renderable.draw(e),e.translate(-t,-i)}if(me.debug.renderHitBox&&this.collisionBox&&this.collisionBox.draw(e,"red"),me.debug.renderVelocity){var t=~~(this.pos.x+this.hWidth),i=~~(this.pos.y+this.hHeight);e.strokeStyle="blue",e.lineWidth=1,e.beginPath(),e.moveTo(t,i),e.lineTo(t+~~(this.vel.x*this.hWidth),i+~~(this.vel.y*this.hHeight)),e.stroke()}},destroy:function(){this.renderable&&(this.renderable.destroy.apply(this.renderable,arguments),this.renderable=null),this.onDestroyEvent.apply(this,arguments),this.pos=null,this.collisionBox=null},onDestroyEvent:function(){}}),me.CollectableEntity=me.ObjectEntity.extend({init:function(e,t,i){this.parent(e,t,i),this.type=me.game.COLLECTABLE_OBJECT
}}),me.LevelEntity=me.ObjectEntity.extend({init:function(e,t,i){this.parent(e,t,i),this.nextlevel=i.to,this.fade=i.fade,this.duration=i.duration,this.fading=!1,this.gotolevel=i.to},onFadeComplete:function(){me.levelDirector.loadLevel(this.gotolevel),me.game.viewport.fadeOut(this.fade,this.duration)},goTo:function(e){this.gotolevel=e||this.nextlevel,this.fade&&this.duration?this.fading||(this.fading=!0,me.game.viewport.fadeIn(this.fade,this.duration,this.onFadeComplete.bind(this))):me.levelDirector.loadLevel(this.gotolevel)},onCollision:function(){this.goTo()}})}(window),function(e){me.ScreenObject=me.Renderable.extend({addAsObject:!1,z:999,init:function(e,t){this.parent(new me.Vector2d(0,0),0,0),this.addAsObject=this.visible=e===!0||!1,this.isPersistent=this.visible&&t===!0||!1},reset:function(){me.game.reset(),this.onResetEvent.apply(this,arguments),this.addAsObject&&(this.visible=!0,this.set(me.game.viewport.pos,me.game.viewport.width,me.game.viewport.height),me.game.add(this,this.z)),me.game.sort()},destroy:function(){this.onDestroyEvent.apply(this,arguments)},update:function(){return!1},onUpdateFrame:function(){me.timer.update(),me.game.update(),me.game.draw(),me.video.blitSurface()},draw:function(){},onResetEvent:function(){},onDestroyEvent:function(){}}),me.state=function(){function t(){if(-1==l&&-1==u){if(me.timer.reset(),me.sys.useNativeAnimFrame){if(u=window.requestAnimationFrame(i),-1!=u)return;me.sys.useNativeAnimFrame=!1}l=setInterval(p,~~(1e3/me.sys.fps))}}function i(){p(),-1!=u&&(u=window.requestAnimationFrame(i))}function n(){-1!=l&&(clearInterval(l),l=-1),-1!=u&&(window.cancelAnimationFrame(u),u=-1)}function s(e){n(),c[h]&&(c[h].screen.visible&&me.game.remove.call(me.game,c[h].screen,!0),c[h].screen.destroy()),c[e]&&(h=e,c[h].screen.reset.apply(c[h].screen,f),p=c[h].screen.onUpdateFrame.bind(c[h].screen),t(),d&&d(),me.game.repaint())}for(var r=["ms","moz","webkit","o"],o=0;r.length>o&&!window.requestAnimationFrame;++o)window.requestAnimationFrame=window[r[o]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[r[o]+"CancelAnimationFrame"]||window[r[o]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(){return-1}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(){return-1});var a={},h=-1,l=-1,u=-1,c={},m={color:"",duration:0},d=null,f=null,p=null;return a.LOADING=0,a.MENU=1,a.READY=2,a.PLAY=3,a.GAMEOVER=4,a.GAME_END=5,a.SCORE=6,a.CREDITS=7,a.SETTINGS=8,a.USER=100,a.onPause=null,a.onResume=null,a.init=function(){a.set(a.LOADING,me.loadingScreen),e.addEventListener("blur",function(){me.sys.pauseOnBlur&&h!=a.LOADING&&a.pause(!0),a.onPause&&a.onPause(),me.event.publish(me.event.STATE_PAUSE)},!1),e.addEventListener("focus",function(){me.sys.pauseOnBlur&&h!=a.LOADING&&(a.resume(!0),me.game.repaint()),a.onResume&&a.onResume(),me.event.publish(me.event.STATE_RESUME)},!1)},a.pause=function(e){n(),e&&me.audio.pauseTrack()},a.resume=function(e){t(),e&&me.audio.resumeTrack()},a.isRunning=function(){return-1!=l||-1!=u},a.set=function(e,t){c[e]={},c[e].screen=t,c[e].transition=!0},a.current=function(){return c[h].screen},a.transition=function(e,t,i){"fade"==e&&(m.color=t,m.duration=i)},a.setTransition=function(e,t){c[e].transition=t},a.change=function(e){if(c[e]===void 0)throw"melonJS : Undefined ScreenObject for state '"+e+"'";f=null,arguments.length>1&&(f=Array.prototype.slice.call(arguments,1)),m.duration&&c[e].transition?(d=function(){me.game.viewport.fadeOut(m.color,m.duration)},me.game.viewport.fadeIn(m.color,m.duration,function(){s.defer(e)})):s.defer(e)},a.isCurrent=function(e){return h==e},a}()}(window),function(){me.DefaultLoadingScreen=me.ScreenObject.extend({init:function(){this.parent(!0),this.invalidate=!1,this.handle=null},onResetEvent:function(){this.logo1=new me.Font("century gothic",32,"white","middle"),this.logo2=new me.Font("century gothic",32,"#89b002","middle"),this.logo2.bold(),this.logo1.textBaseline=this.logo2.textBaseline="alphabetic",this.handle=me.event.subscribe(me.event.LOADER_PROGRESS,this.onProgressUpdate.bind(this)),this.loadPercent=0},onDestroyEvent:function(){this.logo1=this.logo2=null,this.handle&&(me.event.unsubscribe(this.handle),this.handle=null)},onProgressUpdate:function(e){this.loadPercent=e,this.invalidate=!0},update:function(){return this.invalidate===!0?(this.invalidate=!1,!0):!1},draw:function(e){var t=this.logo1.measureText(e,"melon").width,i=(me.video.getWidth()-t-this.logo2.measureText(e,"JS").width)/2,n=me.video.getHeight()/2;me.video.clearSurface(e,"black"),this.logo1.draw(e,"melon",i,n),i+=t,this.logo2.draw(e,"JS",i,n),n+=this.logo1.measureText(e,"melon").height/2;var s=Math.floor(this.loadPercent*me.video.getWidth());e.strokeStyle="silver",e.strokeRect(0,n,me.video.getWidth(),6),e.fillStyle="#89b002",e.fillRect(2,n+2,s-4,2)}}),me.loader=function(){function e(){c==u?r.onload?(clearTimeout(m),setTimeout(function(){r.onload(),me.event.publish(me.event.LOADER_COMPLETE)},300)):console.error("no load callback defined"):m=setTimeout(e,100)}function t(e,t,i){o[e.name]=new Image,o[e.name].onload=t,o[e.name].onerror=i,o[e.name].src=e.src+me.nocache}function i(e,t,i){var n=new XMLHttpRequest,s=me.utils.getFileExtension(e.src).toLowerCase();n.overrideMimeType&&("json"===s?n.overrideMimeType("application/json"):n.overrideMimeType("text/xml")),n.open("GET",e.src+me.nocache,!0),"tmx"===e.type&&me.levelDirector.addTMXLevel(e.name),n.ontimeout=i,n.onreadystatechange=function(){if(4==n.readyState)if(200==n.status||0==n.status&&n.responseText){var r=null;switch(s){case"xml":case"tmx":r=me.sys.ua.match(/msie/i)||!n.responseXML?(new DOMParser).parseFromString(n.responseText,"text/xml"):n.responseXML,s="xml";break;case"json":r=JSON.parse(n.responseText);break;default:throw"melonJS: TMX file format "+s+"not supported !"}a[e.name]={data:r,isTMX:"tmx"===e.type,format:s},t()}else i()},n.send(null)}function n(e,t,i){var n=new XMLHttpRequest;n.overrideMimeType&&n.overrideMimeType("application/json"),n.open("GET",e.src+me.nocache,!0),n.ontimeout=i,n.onreadystatechange=function(){4==n.readyState&&(200==n.status||0==n.status&&n.responseText?(l[e.name]=JSON.parse(n.responseText),t()):i())},n.send(null)}function s(e,t,i){var n=new XMLHttpRequest;n.open("GET",e.src+me.nocache,!1),n.responseType="arraybuffer",n.onerror=i,n.onload=function(){var i=n.response;if(i){var s=new Uint8Array(i),r=[];h[e.name]=new dataType;for(var o=0;s.byteLength>o;o++)r[o]=String.fromCharCode(s[o]);h[e.name].data=r.join(""),t()}},n.send()}var r={},o={},a={},h={},l={},u=0,c=0,m=0;return r.onload=void 0,r.onProgress=void 0,r.onResourceLoaded=function(){c++;var e=r.getLoadProgress();r.onProgress&&r.onProgress(e),me.event.publish(me.event.LOADER_PROGRESS,[e])},r.onLoadingError=function(e){throw"melonJS: Failed loading resource "+e.src},r.preload=function(t){for(var i=0;t.length>i;i++)u+=r.load(t[i],r.onResourceLoaded.bind(r),r.onLoadingError.bind(r,t[i]));e()},r.load=function(e,r,o){switch(e.name=e.name.toLowerCase(),e.type){case"binary":return s.call(this,e,r,o),1;case"image":return t.call(this,e,r,o),1;case"tps":return n.call(this,e,r,o),1;case"tmx":case"tsx":return i.call(this,e,r,o),1;case"audio":if(me.audio.isAudioEnable())return me.audio.load(e,r,o),1;break;default:throw"melonJS: me.loader.load : unknown or invalid resource type : "+e.type}return 0},r.unload=function(e){switch(e.name=e.name.toLowerCase(),e.type){case"binary":return e.name in h?(delete h[e.name],!0):!1;case"image":return e.name in o?(delete o[e.name],!0):!1;case"tps":return e.name in l?(delete l[e.name],!0):!1;case"tmx":case"tsx":return e.name in a?(delete a[e.name],!0):!1;case"audio":return me.audio.unload(e.name);default:throw"melonJS: me.loader.unload : unknown or invalid resource type : "+e.type}},r.unloadAll=function(){var e;for(e in h)r.unload(e);for(e in o)r.unload(e);for(e in a)r.unload(e);for(e in l)r.unload(e);me.audio.unloadAll()},r.getTMXFormat=function(e){return e=e.toLowerCase(),e in a?a[e].format:null},r.getTMX=function(e){return e=e.toLowerCase(),e in a?a[e].data:null},r.getBinary=function(e){return e=e.toLowerCase(),e in h?h[e]:null},r.getAtlas=function(e){return e=e.toLowerCase(),e in l?l[e]:null},r.getImage=function(e){if(e=e.toLowerCase(),e in o){if(me.sys.cacheImage===!0){var t=me.video.createCanvasSurface(o[e].width,o[e].height);return t.drawImage(o[e],0,0),t.canvas}return o[e]}return null},r.getLoadProgress=function(){return c/u},r}()}(window),function(){me.Font=Object.extend({font:null,height:null,color:null,textAlign:"left",textBaseline:"top",lineHeight:1,init:function(e,t,i,n){this.set(e,t,i,n)},bold:function(){this.font="bold "+this.font},italic:function(){this.font="italic "+this.font},set:function(e,t,i,n){for(var s=e.split(","),r=0;s.length>r;r++)s[r]="'"+s[r]+"'";this.height=parseInt(t),"number"==typeof t&&(t=""+t+"px"),this.font=t+" "+s.join(","),this.color=i,n&&(this.textAlign=n)},getRect:function(){return new me.Rect(new Vector2d(0,0),0,0)},measureText:function(e,t){e.font=this.font,e.fillStyle=this.color,e.textAlign=this.textAlign,e.textBaseline=this.textBaseline;for(var i=(""+t).split("\n"),n=0,s=0,r=0;i.length>r;r++)n=Math.max(e.measureText(i[r].trim()).width,n),s+=this.height*this.lineHeight;return{width:n,height:s}},draw:function(e,t,i,n){e.font=this.font,e.fillStyle=this.color,e.textAlign=this.textAlign,e.textBaseline=this.textBaseline;for(var s=(""+t).split("\n"),r=0;s.length>r;r++)e.fillText(s[r].trim(),~~i,~~n),n+=this.height*this.lineHeight}}),me.BitmapFont=me.Font.extend({size:null,sSize:null,firstChar:32,charCount:0,init:function(e,t,i,n){this.parent(e,null,null),this.size=new me.Vector2d,this.sSize=new me.Vector2d,this.firstChar=n||32,this.loadFontMetrics(e,t),this.textAlign="left",this.textBaseline="top",i&&this.resize(i)},loadFontMetrics:function(e,t){this.font=me.loader.getImage(e),this.size.x=t.x||t,this.size.y=t.y||this.font.height,this.sSize.copy(this.size),this.charCount=~~(this.font.width/this.size.x)},set:function(e,t){this.textAlign=e,t&&this.resize(t)},resize:function(e){this.sSize.setV(this.size),this.sSize.x*=e,this.sSize.y*=e},measureText:function(e,t){for(var i=(""+t).split("\n"),n=0,s=0,r=0;i.length>r;r++)n=Math.max(i[r].trim().length*this.sSize.x,n),s+=this.sSize.y*this.lineHeight;return{width:n,height:s}},draw:function(e,t,i,n){for(var s=(""+t).split("\n"),r=i,o=this.sSize.y*this.lineHeight,a=0;s.length>a;a++){var i=r,n=n,h=s[a].trim(),l=h.length*this.sSize.x;switch(this.textAlign){case"right":i-=l;break;case"center":i-=.5*l;break;default:}switch(this.textBaseline){case"middle":n-=.5*o;break;case"ideographic":case"alphabetic":case"bottom":n-=o;break;default:}for(var u=0,c=h.length;c>u;u++){var m=h.charCodeAt(u)-this.firstChar;e.drawImage(this.font,this.size.x*(m%this.charCount),this.size.y*~~(m/this.charCount),this.size.x,this.size.y,~~i,~~n,this.sSize.x,this.sSize.y),i+=this.sSize.x}n+=o}}})}(window),function(){me.GUI_Object=me.SpriteObject.extend({isClickable:!0,updated:!1,init:function(e,t,i){this.parent(e,t,"string"==typeof i.image?me.loader.getImage(i.image):i.image,i.spritewidth,i.spriteheight),this.floating=!0,me.input.registerMouseEvent("mousedown",this,this.clicked.bind(this))},update:function(){return this.updated?(this.updated=!1,!0):!1},clicked:function(){return this.isClickable?(this.updated=!0,this.onClick()):void 0},onClick:function(){return!0},onDestroyEvent:function(){me.input.releaseMouseEvent("mousedown",this)}})}(window),function(){me.HUD_Item=Object.extend({init:function(e,t,i){this.pos=new me.Vector2d(e||0,t||0),this.visible=!0,this.defaultvalue=i||0,this.value=i||0,this.updated=!0},reset:function(){this.set(this.defaultvalue)},set:function(e){return this.value=e,this.updated=!0,!0},update:function(e){return this.set(this.value+e)},draw:function(){}}),me.HUD_Object=me.Renderable.extend({init:function(e,t,i,n,s){this.parent(new me.Vector2d(e||0,t||0),i||me.video.getWidth(),n||me.video.getHeight()),this.bgcolor=s,this.HUDItems={},this.HUDobj=[],this.objCount=0,this.visible=!0,this.floating=!0,this.HUD_invalidated=!0,this.HUDCanvas=me.video.createCanvas(this.width,this.height),this.HUDCanvasSurface=this.HUDCanvas.getContext("2d"),me.video.setImageSmoothing(this.HUDCanvasSurface,me.sys.scalingInterpolation),this.z=999,this.isPersistent=!0},addItem:function(e,t){this.HUDItems[e]=t,this.HUDobj.push(this.HUDItems[e]),this.objCount++,this.HUD_invalidated=!0},removeItem:function(e){this.HUDItems[e]&&(this.HUDobj.splice(this.HUDobj.indexOf(this.HUDItems[e]),1),this.HUDItems[e]=null,this.objCount--,this.HUD_invalidated=!0)},setItemValue:function(e,t){this.HUDItems[e]&&1==this.HUDItems[e].set(t)&&(this.HUD_invalidated=!0)},updateItemValue:function(e,t){this.HUDItems[e]&&1==this.HUDItems[e].update(t)&&(this.HUD_invalidated=!0)},getItemValue:function(e){return this.HUDItems[e]?this.HUDItems[e].value:0},update:function(){return this.HUD_invalidated},reset:function(e){void 0!=e?(this.HUDItems[e]&&this.HUDItems[e].reset(),this.HUD_invalidated=!0):this.resetAll()},resetAll:function(){for(var e,t=this.objCount;t--,e=this.HUDobj[t];)e.reset();this.HUD_invalidated=!0},draw:function(e){if(this.HUD_invalidated){this.bgcolor?me.video.clearSurface(this.HUDCanvasSurface,this.bgcolor):this.HUDCanvas.width=this.HUDCanvas.width;for(var t,i=this.objCount;i--,t=this.HUDobj[i];)t.visible&&(t.draw(this.HUDCanvasSurface,0,0),t.updated&&(t.updated=!1))}e.drawImage(this.HUDCanvas,this.pos.x,this.pos.y),this.HUD_invalidated=!1}})}(window),function(){me.audio=function(){function e(e){var t="",i=e.length;if(me.sys.sound)for(var n="",s=0;i>s&&(n=e[s].toLowerCase().trim(),!o.capabilities[n]||!o.capabilities[n].canPlay||""!==t&&"probably"!==o.capabilities[n].canPlayType||(t=n,"probably"!==o.capabilities[n].canPlayType));s++);return""===t&&(c=!1),t}function t(e){for(var t,i=a[e],n=0;t=i[n++];)if(t.ended||!t.currentTime)return t.currentTime=m,t;return i[0].pause(),i[0].currentTime=m,i[0]}function i(e,t){if(d++>3){var i="melonJS: failed loading "+e+"."+h;if(me.sys.stopOnAudioError!==!1)throw i;me.audio.disable(),t&&t(),console.log(i+", disabling audio")}else a[e][0].load()}function n(e,t,i){if(d=0,t>1)for(var n=a[e][0],s=1;t>s;s++)a[e][s]=new Audio(n.src),a[e][s].preload="auto",a[e][s].load();i&&i()}function s(e,i,n,s){var r=t(e.toLowerCase());return r.loop=i||!1,r.volume=s?parseFloat(s).clamp(0,1):f.volume,r.muted=f.muted,r.play(),n&&!i&&r.addEventListener("ended",function(){r.removeEventListener("ended",arguments.callee,!1),n()},!1),r}function r(e,t,i){return i&&!t&&setTimeout(i,2e3),null}var o={},a={},h=-1,l=null,u=null,c=!0,m=0,d=0,f={volume:1,muted:!1},p=!1,g=[];return o.capabilities={mp3:{codec:"audio/mpeg",canPlay:!1,canPlayType:"no"},ogg:{codec:'audio/ogg; codecs="vorbis"',canPlay:!1,canPlayType:"no"},m4a:{codec:'audio/mp4; codecs="mp4a.40.2"',canPlay:!1,canPlayType:"no"},wav:{codec:'audio/wav; codecs="1"',canPlay:!1,canPlayType:"no"}},o.detectCapabilities=function(){var e=document.createElement("audio");if(e.canPlayType)for(var t in o.capabilities){var i=e.canPlayType(o.capabilities[t].codec);""!==i&&"no"!==i&&(o.capabilities[t].canPlay=!0,o.capabilities[t].canPlayType=i),me.sys.sound|=o.capabilities[t].canPlay}},o.init=function(t){if(!me.initialized)throw"melonJS: me.audio.init() called before engine initialization.";return t=new String(t?t:"mp3"),t=t.split(","),h=e(t),me.sys.isMobile&&!navigator.isCocoonJS&&(c=!1),o.play=o.isAudioEnable()?s:r,o.isAudioEnable()},o.isAudioEnable=function(){return c},o.enable=function(){c=me.sys.sound,o.play=c?s:r},o.disable=function(){me.audio.stopTrack(),o.play=r,c=!1},o.load=function(e,t,s){if(-1==h)return 0;if(me.sys.isMobile&&!navigator.isCocoonJS){if(p)return g.push([e,t,s]),void 0;p=!0}var r=e.channel||1,l="canplaythrough";e.stream!==!0||me.sys.isMobile||(r=1,l="canplay");var u=new Audio(e.src+e.name+"."+h+me.nocache);return u.preload="auto",u.addEventListener(l,function(){u.removeEventListener(l,arguments.callee,!1),p=!1,n.call(me.audio,e.name,r,t);var i=g.shift();i&&o.load.apply(o,i)},!1),u.addEventListener("error",function(){i.call(me.audio,e.name,s)},!1),u.load(),a[e.name]=[u],1},o.stop=function(e){if(c)for(var t=a[e.toLowerCase()],i=t.length;i--;)t[i].pause(),t[i].currentTime=m},o.pause=function(e){if(c)for(var t=a[e.toLowerCase()],i=t.length;i--;)t[i].pause()},o.playTrack=function(e,t){u=me.audio.play(e,!0,null,t),l=e.toLowerCase()},o.stopTrack=function(){c&&u&&(u.pause(),l=null,u=null)},o.setVolume=function(e){"number"==typeof e&&(f.volume=e.clamp(0,1))},o.getVolume=function(){return f.volume},o.mute=function(e,t){t=void 0===t?!0:!!t;for(var i,n=a[e.toLowerCase()],s=0;i=n[s++];)i.muted=t},o.unmute=function(e){o.mute(e,!1)},o.muteAll=function(){f.muted=!0;for(var e in a)o.mute(e,f.muted)},o.unmuteAll=function(){f.muted=!1;for(var e in a)o.mute(e,f.muted)},o.getCurrentTrack=function(){return l},o.pauseTrack=function(){c&&u&&u.pause()},o.resumeTrack=function(){c&&u&&u.play()},o.unload=function(e){return e=e.toLowerCase(),e in a?(l===e?o.stopTrack():o.stop(e),delete a[e],!0):!1},o.unloadAll=function(){for(var e in a)o.unload(e)},o}()}(window),function(){me.timer=function(){function e(e){i.replaceChild(document.createTextNode("("+e+"/"+me.sys.fps+" fps)"),i.firstChild)}var t={},i=null,n=0,s=0,r=0,o=0,a=0,h=Math.ceil(1e3/me.sys.fps),l=1.25*(1e3/me.sys.fps);return t.tick=1,t.fps=0,t.init=function(){i=document.getElementById("framecounter"),null!==i&&(me.debug.displayFPS=!0),t.reset()},t.reset=function(){o=r=Date.now(),s=0,n=0},t.getTime=function(){return o},t.update=function(){r=o,o=Date.now(),a=o-r,me.debug.displayFPS&&(n++,s+=a,0==n%10&&(this.fps=(~~(1e3*n/s)).clamp(0,me.sys.fps),s=0,n=0),null!==i&&e(this.fps)),t.tick=a>l&&me.sys.interpolation?a/h:1},t}(),me.video=function(){function e(){return navigator.isCocoonJS&&!me.sys.dirtyRegion?"screencanvas":"canvas"}var t={},i=null,n=null,s=null,r=null,o=null,a=-1,h=!1,l=0,u=0,c=!1,m=!0;return t.init=function(e,a,d,f,p,g){if(!me.initialized)throw"melonJS: me.video.init() called before engine initialization.";return h=f||!1,c="auto"===p||!1,m=void 0!==g?g:!0,p="auto"!==p?parseFloat(p||1):1,me.sys.scale=new me.Vector2d(p,p),(c||1!==p)&&(h=!0),l=a*me.sys.scale.x,u=d*me.sys.scale.y,window.addEventListener("resize",function(e){me.event.publish(me.event.WINDOW_ONRESIZE,[e])},!1),window.addEventListener("orientationchange",function(e){me.event.publish(me.event.WINDOW_ONRESIZE,[e])},!1),me.event.subscribe(me.event.WINDOW_ONRESIZE,me.video.onresize.bind(me.video)),i=t.createCanvas(l,u,!0),e&&(o=document.getElementById(e)),o||(o=document.body),o.appendChild(i),i.getContext?(n=i.getContext("2d"),n.canvas||(n.canvas=i),me.video.setImageSmoothing(n,me.sys.scalingInterpolation),h?(s=t.createCanvas(a,d,!1),r=s.getContext("2d"),r.canvas||(r.canvas=s),me.video.setImageSmoothing(r,me.sys.scalingInterpolation)):(s=i,r=n),c&&me.video.onresize(null),!0):!1},t.getWrapper=function(){return o},t.getWidth=function(){return s.width},t.getPos=function(e){for(var t=e||i,n=new me.Vector2d(t.offsetLeft,t.offsetTop);t=t.offsetParent;)n.x+=t.offsetLeft,n.y+=t.offsetTop;return n},t.getHeight=function(){return s.height},t.createCanvas=function(t,i,n){if(0===t||0===i)throw Error("melonJS: width or height was zero, Canvas could not be initialized !");var r=n===!0?e():"canvas",o=document.createElement(r);return o.width=t||s.width,o.height=i||s.height,o},t.createCanvasSurface=function(e,i){var n=t.createCanvas(e,i,!1),s=n.getContext("2d");return s.canvas||(s.canvas=n),me.video.setImageSmoothing(s,me.sys.scalingInterpolation),s},t.getScreenCanvas=function(){return i},t.getScreenContext=function(){return n},t.getSystemCanvas=function(){return s},t.getSystemContext=function(){return r},t.onresize=function(){if(c){var e=me.video.getScreenCanvas().parentNode,t=e.width||window.innerWidth,i=e.height||window.innerHeight;if(a&&clearTimeout(a),m){var n=me.video.getWidth()/me.video.getHeight(),s=t/i;if(n>s)var r=t/me.video.getWidth();else var r=i/me.video.getHeight();a=me.video.updateDisplaySize.defer(r,r)}else a=me.video.updateDisplaySize.defer(t/me.video.getWidth(),i/me.video.getHeight())}else me.input.mouse.offset=me.video.getPos()},t.updateDisplaySize=function(e,n){me.sys.scale.set(e,n),i.width=l=s.width*e,i.height=u=s.height*n,me.input.mouse.offset=me.video.getPos(),t.blitSurface(),a=-1},t.clearSurface=function(e,t){var i=e.canvas.width,n=e.canvas.height;e.save(),e.setTransform(1,0,0,1,0,0),"rgba"===t.substr(0,4)&&e.clearRect(0,0,i,n),e.fillStyle=t,e.fillRect(0,0,i,n),e.restore()},t.scale=function(e,t){e.translate(-(e.canvas.width*t-e.canvas.width>>1),-(e.canvas.height*t-e.canvas.height>>1)),e.scale(t,t)},t.setImageSmoothing=function(e,t){for(var i=["ms","moz","webkit","o"],n=0;i.length>n;++n)void 0!==e[i[n]+"ImageSmoothingEnabled"]&&(e[i[n]+"ImageSmoothingEnabled"]=t===!0);e.imageSmoothingEnabled=t===!0},t.setAlpha=function(e,t){e.globalCompositeOperation=t?"source-over":"copy"},t.blitSurface=function(){t.blitSurface=h?function(){n.drawImage(s,0,0,s.width,s.height,0,0,l,u)}:function(){},t.blitSurface()},t.applyRGBFilter=function(e,i,n){var s=t.createCanvasSurface(e.width,e.height,!1),r=me.utils.getPixels(e),o=r.data;switch(i){case"b&w":for(var a=0,h=o.length;h>a;a+=4){var l=3*o[a]+4*o[a+1]+o[a+2]>>>3;o[a]=l,o[a+1]=l,o[a+2]=l}break;case"brightness":for(var u=Math.abs(n).clamp(0,1),a=0,h=o.length;h>a;a+=4)o[a]*=u,o[a+1]*=u,o[a+2]*=u;break;case"transparent":for(var a=0,h=o.length;h>a;a+=4)me.utils.RGBToHex(o[a],o[a+1],o[a+2])===n&&(o[a+3]=0);break;default:return null}return s.putImageData(r,0,0),s},t}()}(window),function(e){me.input=function(){function t(){y||(e.addEventListener("keydown",s,!1),e.addEventListener("keyup",r,!1),y=!0)}function i(){if(!v){if(d.touches.push({x:0,y:0}),d.mouse.pos=new me.Vector2d(0,0),d.mouse.offset=me.video.getPos(),me.sys.touch){me.video.getScreenCanvas().addEventListener("touchmove",l,!1);for(var t=2;b.length>t;++t)me.video.getScreenCanvas().addEventListener(b[t],c,!1)}else{me.video.getScreenCanvas().addEventListener("mousemove",l,!1),e.addEventListener("mousewheel",h,!1);for(var t=2;x.length>t;++t)me.video.getScreenCanvas().addEventListener(x[t],u,!1)}v=!0}}function n(e){return e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,e.preventDefault?e.preventDefault():e.returnValue=!1,!1}function s(e,t){var i=f[t||e.keyCode||e.which];return i?(T[i]||(p[i]=!0,T[i]=g[i],me.event.publish(me.event.KEYDOWN,[i])),n(e)):!0}function r(e,t){var i=f[t||e.keyCode||e.which];return i?(p[i]=!1,T[i]=!1,me.event.publish(me.event.KEYUP,[i]),n(e)):!0}function o(e){var t=!1,i=d.mouse.handlers[e.type];if(i)for(var n=me.game.viewport.pos,s=me.game.currentLevel.pos,r=0,o=d.touches.length;o>r;r++)for(var a,h=d.touches[r].x,l=d.touches[r].y,u=i.length;u--,a=i[u];){if(a.floating===!1)var c={x:h+n.x-s.x,y:l+n.y-s.y};else var c={x:h,y:l};if((null===a.rect||a.rect.containsPoint(c))&&a.cb(e)===!1){t=!0;break}}return t}function a(e){if(d.touches.length=0,e.touches)for(var t=d.mouse.offset,i=0,n=e.changedTouches.length;n>i;i++){var s=e.changedTouches[i],r=s.clientX-t.x,o=s.clientY-t.y,a=me.sys.scale;(1!=a.x||1!=a.y)&&(r/=a.x,o/=a.y),d.touches.push({x:r,y:o,id:s.identifier})}else{var t=d.mouse.offset,r=e.pageX-t.x,o=e.pageY-t.y,a=me.sys.scale;(1!=a.x||1!=a.y)&&(r/=a.x,o/=a.y),d.touches.push({x:r,y:o,id:0})}d.mouse.pos.set(d.touches[0].x,d.touches[0].y)}function h(e){return e.target==me.video.getScreenCanvas()&&o(e)?n(e):!0}function l(e){return a(e),o(e)?n(e):!0}function u(e){if(o(e))return n(e);var t=d.mouse.bind[e.button||0];return t?"mousedown"===e.type||"touchstart"===e.type?s(e,t):r(e,t):!0}function c(e){return a(e),u(e)}function m(e){d.accel=e.accelerationIncludingGravity}var d={},f={},p={},g={},T={},y=!1,v=!1,w=!1,x=["mousewheel","mousemove","mousedown","mouseup","click","dblclick"],b=[void 0,"touchmove","touchstart","touchend","tap","dbltap"];return d.accel={x:0,y:0,z:0},d.mouse={pos:null,offset:null,LEFT:0,MIDDLE:1,RIGHT:2,bind:[0,0,0],handlers:{}},d.touches=[],d.KEY={LEFT:37,UP:38,RIGHT:39,DOWN:40,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,ESC:27,SPACE:32,NUM0:48,NUM1:49,NUM2:50,NUM3:51,NUM4:52,NUM5:53,NUM6:54,NUM7:55,NUM8:56,NUM9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90},d.isKeyPressed=function(e){return p[e]?(g[e]&&(T[e]=!0,p[e]=!1),!0):!1},d.keyStatus=function(e){return T[e]===!0?!0:p[e]},d.triggerKeyEvent=function(e,t){t?s({},e):r({},e)},d.bindKey=function(e,i,n){t(),f[e]=i,p[i]=!1,g[i]=n?n:!1,T[i]=!1},d.unlockKey=function(e){T[e]=!1},d.unbindKey=function(e){p[f[e]]=!1,g[f[e]]=!1,f[e]=null},d.bindMouse=function(e,t){if(i(),!f[t])throw"melonJS : no action defined for keycode "+t;d.mouse.bind[e]=t},d.unbindMouse=function(e){d.mouse.bind[e]=null},d.bindTouch=function(e){d.bindMouse(me.input.mouse.LEFT,e)},d.unbindTouch=function(){d.unbindMouse(me.input.mouse.LEFT)},d.registerMouseEvent=function(e,t,n,s){if(i(),me.sys.touch&&-1!==x.indexOf(e)&&(e=b[x.indexOf(e)]),e&&(-1!==x.indexOf(e)||-1!==b.indexOf(e))){d.mouse.handlers[e]||(d.mouse.handlers[e]=[]);var r=t.floating===!0?!0:!1;return s&&(r=s===!0?!0:!1),d.mouse.handlers[e].push({rect:t||null,cb:n,floating:r}),void 0}throw"melonJS : invalid event type : "+e},d.releaseMouseEvent=function(e,t){me.sys.touch&&-1!==x.indexOf(e)&&(e=b[x.indexOf(e)]);{if(!e||-1===x.indexOf(e)&&-1===b.indexOf(e))throw"melonJS : invalid event type : "+e;d.mouse.handlers[e]||(d.mouse.handlers[e]=[]);var i=d.mouse.handlers[e];if(i)for(var n,s=i.length;s--,n=i[s];)n.rect===t&&(n.rect=n.cb=n.floating=null,d.mouse.handlers[e].splice(s,1))}},d.watchAccelerometer=function(){return e.sys.gyro?(w||(e.addEventListener("devicemotion",m,!1),w=!0),!0):!1},d.unwatchAccelerometer=function(){w&&(e.removeEventListener("devicemotion",m,!1),w=!1)},d}()}(window),function(e){var t=function(){var t={},i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return t.decode=function(t){if(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,""),me.sys.nativeBase64)return e.atob(t);for(var n,s,r,o,a,h,l,u=[],c=0;t.length>c;)o=i.indexOf(t.charAt(c++)),a=i.indexOf(t.charAt(c++)),h=i.indexOf(t.charAt(c++)),l=i.indexOf(t.charAt(c++)),n=o<<2|a>>4,s=(15&a)<<4|h>>2,r=(3&h)<<6|l,u.push(String.fromCharCode(n)),64!=h&&u.push(String.fromCharCode(s)),64!=l&&u.push(String.fromCharCode(r));return u=u.join("")},t}();me.utils=function(){var e={},i={},n="",s=0,r=/^.*(\\|\/|\:)/,o=/\.[^\.]*$/;return e.decodeBase64=function(e){return t.decode(e)},e.decodeBase64AsArray=function(e,i){i=i||1;var n,s,r,o=t.decode(e);if("function"==typeof window.Uint32Array)var a=new Uint32Array(o.length/i);else var a=[];for(n=0,r=o.length/i;r>n;n++)for(a[n]=0,s=i-1;s>=0;--s)a[n]+=o.charCodeAt(n*i+s)<<(s<<3);return a},e.decompress=function(){throw"melonJS: GZIP/ZLIB compressed TMX Tile Map not supported!"},e.decodeCSV=function(e,t){e=e.trim().split("\n");for(var i=[],n=0;e.length>n;n++){entries=e[n].split(",",t);for(var s=0;entries.length>s;s++)i.push(+entries[s])}return i},e.getBasename=function(e){return e.replace(r,"").replace(o,"")},e.getFileExtension=function(e){return e.substring(e.lastIndexOf(".")+1,e.length)},e.setNocache=function(e){me.nocache=e?"?"+parseInt(1e7*Math.random()):""},e.HexToRGB=function(e,t){if("#"!==e.charAt(0))return e;if(e=e.substring(1,e.length),null==i[e]){if(6>e.length)var n=e.charAt(0)+e.charAt(0),s=e.charAt(1)+e.charAt(1),r=e.charAt(2)+e.charAt(2);else var n=e.substring(0,2),s=e.substring(2,4),r=e.substring(4,6);i[e]=parseInt(n,16)+","+parseInt(s,16)+","+parseInt(r,16)}return(t?"rgba(":"rgb(")+i[e]+(t?","+t+")":")")},e.RGBToHex=function(e,t,i){return e.toHex()+t.toHex()+i.toHex()},e.getPixels=function(e){if(e instanceof HTMLImageElement){var t=me.video.createCanvasSurface(e.width,e.height);return t.drawImage(e,0,0),t.getImageData(0,0,e.width,e.height)}return e.getContext("2d").getImageData(0,0,e.width,e.height)},e.resetGUID=function(e){n=(""+e).toUpperCase().toHex(),s=0},e.createGUID=function(){return n+"-"+s++},e.applyFriction=function(e,t){return 0>e+t?e+t*me.timer.tick:e-t>0?e-t*me.timer.tick:0},e}()}(window),function(){function e(e){this.defaultvalue=e||0,this.value=e||0,this.updated=!0}e.prototype.reset=function(){this.set(this.defaultvalue)},e.prototype.update=function(e){return this.set(this.value+e)},e.prototype.set=function(e){return this.value=e,this.updated=!0,this.updated},me.gamestat=function(){var t={},i={},n=[],s=0;return t.add=function(t,r){var o=function(t,r){i[t]=new e(r),n.push(i[t]),s++};if(t.constructor===Object)for(var a in t)o(a,t[a]);else o(t,r)},t.updateValue=function(e,t){var n=function(e,t){i[e].update(t)};if(e.constructor===Object)for(var s in e)i[s]&&n(s,e[s]);else i[e]&&n(e,t)},t.setValue=function(e,t){var n=function(e,t){i[e].set(t)};if(e.constructor===Object)for(var s in e)i[s]&&n(s,e[s]);else i[e]&&n(e,t)},t.getItemValue=function(e){return i[e]?i[e].value:0},t.reset=function(e){void 0!=e?i[e]&&i[e].reset():t.resetAll()},t.resetAll=function(){for(var e,t=s;t--,e=n[t];)e.reset()},t}()}(window),function(){me.COLLISION_LAYER="collision",me.TMX_TAG_MAP="map",me.TMX_TAG_NAME="name",me.TMX_TAG_VALUE="value",me.TMX_TAG_VERSION="version",me.TMX_TAG_ORIENTATION="orientation",me.TMX_TAG_WIDTH="width",me.TMX_TAG_HEIGHT="height",me.TMX_TAG_OPACITY="opacity",me.TMX_TAG_TRANS="trans",me.TMX_TAG_TILEWIDTH="tilewidth",me.TMX_TAG_TILEHEIGHT="tileheight",me.TMX_TAG_TILEOFFSET="tileoffset",me.TMX_TAG_FIRSTGID="firstgid",me.TMX_TAG_GID="gid",me.TMX_TAG_TILE="tile",me.TMX_TAG_ID="id",me.TMX_TAG_DATA="data",me.TMX_TAG_COMPRESSION="compression",me.TMX_TAG_GZIP="gzip",me.TMX_TAG_ZLIB="zlib",me.TMX_TAG_ENCODING="encoding",me.TMX_TAG_ATTR_BASE64="base64",me.TMX_TAG_CSV="csv",me.TMX_TAG_SPACING="spacing",me.TMX_TAG_MARGIN="margin",me.TMX_TAG_PROPERTIES="properties",me.TMX_TAG_PROPERTY="property",me.TMX_TAG_IMAGE="image",me.TMX_TAG_SOURCE="source",me.TMX_TAG_VISIBLE="visible",me.TMX_TAG_TILESET="tileset",me.TMX_TAG_LAYER="layer",me.TMX_TAG_TILE_LAYER="tilelayer",me.TMX_TAG_IMAGE_LAYER="imagelayer",me.TMX_TAG_OBJECTGROUP="objectgroup",me.TMX_TAG_OBJECT="object",me.TMX_TAG_X="x",me.TMX_TAG_Y="y",me.TMX_TAG_WIDTH="width",me.TMX_TAG_HEIGHT="height",me.TMX_TAG_POLYGON="polygon",me.TMX_TAG_POLYLINE="polyline",me.TMX_TAG_POINTS="points",me.TMX_BACKGROUND_COLOR="backgroundcolor"}(window),function(){me.TMXUtils=function(){function e(e){if(!e||e.isBoolean())e=e?"true"===e:!0;else if(e.isNumeric())e=Number(e);else if(e.match(/^json:/i)){var t=e.split(/^json:/i)[1];try{e=JSON.parse(t)}catch(i){throw"Unable to parse JSON: "+t}}return e}var t={};return t.applyTMXPropertiesFromXML=function(t,i){var n=i.getElementsByTagName(me.TMX_TAG_PROPERTIES)[0];if(n)for(var s=n.getElementsByTagName(me.TMX_TAG_PROPERTY),r=0;s.length>r;r++){var o=me.mapReader.TMXParser.getStringAttribute(s[r],me.TMX_TAG_NAME),a=me.mapReader.TMXParser.getStringAttribute(s[r],me.TMX_TAG_VALUE);t[o]=e(a)}},t.applyTMXPropertiesFromJSON=function(t,i){var n=i[me.TMX_TAG_PROPERTIES];if(n)for(var s in n)n.hasOwnProperty(s)&&(t[s]=e(n[s]))},t.mergeProperties=function(e,t,i){for(var n in t)(i||void 0===e[n])&&(e[n]=t[n]);return e},t}()}(window),function(){me.TMXOBjectGroup=Object.extend({initFromXML:function(e,t,i,n){this.name=e,this.width=me.mapReader.TMXParser.getIntAttribute(t,me.TMX_TAG_WIDTH),this.height=me.mapReader.TMXParser.getIntAttribute(t,me.TMX_TAG_HEIGHT),this.visible=1==me.mapReader.TMXParser.getIntAttribute(t,me.TMX_TAG_VISIBLE,1),this.z=n,this.objects=[],t.firstChild&&t.firstChild.nextSibling.nodeName===me.TMX_TAG_PROPERTIES&&me.TMXUtils.applyTMXPropertiesFromXML(this,t);for(var s=t.getElementsByTagName(me.TMX_TAG_OBJECT),r=0;s.length>r;r++){var o=new me.TMXOBject;o.initFromXML(s[r],i,n),this.objects.push(o)}},initFromJSON:function(e,t,i,n){var s=this;this.name=e,this.width=t[me.TMX_TAG_WIDTH],this.height=t[me.TMX_TAG_HEIGHT],this.visible=t[me.TMX_TAG_VISIBLE],this.z=n,this.objects=[],me.TMXUtils.applyTMXPropertiesFromJSON(this,t),t.objects.forEach(function(e){var t=new me.TMXOBject;t.initFromJSON(e,i,n),s.objects.push(t)
})},reset:function(){this.objects=null},getObjectCount:function(){return this.objects.length},getObjectByIndex:function(e){return this.objects[e]}}),me.TMXOBject=Object.extend({initFromXML:function(e,t,i){if(this.name=me.mapReader.TMXParser.getStringAttribute(e,me.TMX_TAG_NAME),this.x=me.mapReader.TMXParser.getIntAttribute(e,me.TMX_TAG_X),this.y=me.mapReader.TMXParser.getIntAttribute(e,me.TMX_TAG_Y),this.z=i,this.width=me.mapReader.TMXParser.getIntAttribute(e,me.TMX_TAG_WIDTH,0),this.height=me.mapReader.TMXParser.getIntAttribute(e,me.TMX_TAG_HEIGHT,0),this.gid=me.mapReader.TMXParser.getIntAttribute(e,me.TMX_TAG_GID,null),this.gid)this.setImage(this.gid,t);else{var n=e.getElementsByTagName(me.TMX_TAG_POLYGON);if(this.isPolygon=!0,n.length||(n=e.getElementsByTagName(me.TMX_TAG_POLYLINE),this.isPolygon=!1),n.length){this.points=[];for(var s,r=me.mapReader.TMXParser.getStringAttribute(n[0],me.TMX_TAG_POINTS),o=r.split(" "),a=0;o.length>a;a++)s=o[a].split(","),this.points[a]=new me.Vector2d(+s[0],+s[1])}}me.game.renderer.adjustPosition(this),me.TMXUtils.applyTMXPropertiesFromXML(this,e)},initFromJSON:function(e,t,i){if(this.name=e[me.TMX_TAG_NAME],this.x=parseInt(e[me.TMX_TAG_X]),this.y=parseInt(e[me.TMX_TAG_Y]),this.z=parseInt(i),this.width=parseInt(e[me.TMX_TAG_WIDTH]||0),this.height=parseInt(e[me.TMX_TAG_HEIGHT]||0),this.gid=parseInt(e[me.TMX_TAG_GID])||null,this.gid)this.setImage(this.gid,t);else{var n=e[me.TMX_TAG_POLYGON];if(this.isPolygon=void 0!==n,n||(n=e[me.TMX_TAG_POLYLINE],this.isPolygon=!1),n){this.points=[];var s=this,r=0;n.forEach(function(e){s.points[r++]=new me.Vector2d(parseInt(e.x),parseInt(e.y))})}}me.game.renderer.adjustPosition(this),me.TMXUtils.applyTMXPropertiesFromJSON(this,e)},setImage:function(e,t){var i=t.getTilesetByGid(this.gid);this.width=i.tilewidth,this.height=i.tileheight,this.spritewidth=this.width;var n=new me.Tile(this.x,this.y,i.tilewidth,i.tileheight,this.gid);this.image=i.getTileImage(n)},getObjectPropertyByName:function(e){return this[e]}})}(window),function(){var e=2147483648,t=1073741824,i=536870912;me.Tile=me.Rect.extend({tileId:null,init:function(n,s,r,o,a){this.parent(new me.Vector2d(n*r,s*o),r,o),this.col=n,this.row=s,this.tileId=a,this.flipX=0!==(this.tileId&e),this.flipY=0!==(this.tileId&t),this.flipAD=0!==(this.tileId&i),this.flipped=this.flipX||this.flipY||this.flipAD,this.tileId&=~(e|t|i)}}),me.TMXTileset=Object.extend({type:{SOLID:"solid",PLATFORM:"platform",L_SLOPE:"lslope",R_SLOPE:"rslope",LADDER:"ladder",TOPLADDER:"topladder",BREAKABLE:"breakable"},init:function(){this.TileProperties=[],this.tileXOffset=[],this.tileYOffset=[]},initFromXML:function(e){this.firstgid=me.mapReader.TMXParser.getIntAttribute(e,me.TMX_TAG_FIRSTGID);var t=me.mapReader.TMXParser.getStringAttribute(e,me.TMX_TAG_SOURCE);if(t){if(t=me.utils.getBasename(t),e=me.loader.getTMX(t),!e)throw"melonJS:"+t+" TSX tileset not found";me.mapReader.TMXParser.parseFromString(e),e=me.mapReader.TMXParser.getFirstElementByTagName("tileset")}this.name=me.mapReader.TMXParser.getStringAttribute(e,me.TMX_TAG_NAME),this.tilewidth=me.mapReader.TMXParser.getIntAttribute(e,me.TMX_TAG_TILEWIDTH),this.tileheight=me.mapReader.TMXParser.getIntAttribute(e,me.TMX_TAG_TILEHEIGHT),this.spacing=me.mapReader.TMXParser.getIntAttribute(e,me.TMX_TAG_SPACING,0),this.margin=me.mapReader.TMXParser.getIntAttribute(e,me.TMX_TAG_MARGIN,0),this.tileoffset=new me.Vector2d(0,0);var i=e.getElementsByTagName(me.TMX_TAG_TILEOFFSET);i.length>0&&(this.tileoffset.x=me.mapReader.TMXParser.getIntAttribute(i[0],me.TMX_TAG_X),this.tileoffset.y=me.mapReader.TMXParser.getIntAttribute(i[0],me.TMX_TAG_Y));for(var n=e.getElementsByTagName(me.TMX_TAG_TILE),s=0;n.length>s;s++){var r=me.mapReader.TMXParser.getIntAttribute(n[s],me.TMX_TAG_ID)+this.firstgid,o={};me.TMXUtils.applyTMXPropertiesFromXML(o,n[s]),this.setTileProperty(r,o)}var a=e.getElementsByTagName(me.TMX_TAG_IMAGE)[0].getAttribute(me.TMX_TAG_SOURCE),h=a?me.loader.getImage(me.utils.getBasename(a)):null;h||console.log("melonJS: '"+a+"' file for tileset '"+this.name+"' not found!");var l=e.getElementsByTagName(me.TMX_TAG_IMAGE)[0].getAttribute(me.TMX_TAG_TRANS);this.initFromImage(h,l)},initFromJSON:function(e){this.firstgid=e[me.TMX_TAG_FIRSTGID];var t=e[me.TMX_TAG_SOURCE];if(t){t=me.utils.getBasename(t);var e=me.loader.getTMX(t);if(!e)throw"melonJS:"+t+" TSX tileset not found"}this.name=e[me.TMX_TAG_NAME],this.tilewidth=parseInt(e[me.TMX_TAG_TILEWIDTH]),this.tileheight=parseInt(e[me.TMX_TAG_TILEHEIGHT]),this.spacing=parseInt(e[me.TMX_TAG_SPACING]||0),this.margin=parseInt(e[me.TMX_TAG_MARGIN]||0),this.tileoffset=new me.Vector2d(0,0);var i=e[me.TMX_TAG_TILEOFFSET];i&&(this.tileoffset.x=parseInt(i[me.TMX_TAG_X]),this.tileoffset.y=parseInt(i[me.TMX_TAG_Y]));var n=e.tileproperties;for(var s in n){var r={};me.TMXUtils.mergeProperties(r,n[s]),this.setTileProperty(parseInt(s)+this.firstgid,r)}var o=me.utils.getBasename(e[me.TMX_TAG_IMAGE]),a=o?me.loader.getImage(o):null;a||console.log("melonJS: '"+o+"' file for tileset '"+this.name+"' not found!");var h=e[me.TMX_TAG_TRANS]||null;this.initFromImage(a,h)},initFromImage:function(e,t){e&&(this.image=e,this.hTileCount=~~((this.image.width-this.margin)/(this.tilewidth+this.spacing)),this.vTileCount=~~((this.image.height-this.margin)/(this.tileheight+this.spacing))),this.lastgid=this.firstgid+(this.hTileCount*this.vTileCount-1||0),null!==t&&this.image&&(this.image=me.video.applyRGBFilter(this.image,"transparent",t.toUpperCase()).canvas)},setTileProperty:function(e,t){t.isSolid=t.type?t.type.toLowerCase()===this.type.SOLID:!1,t.isPlatform=t.type?t.type.toLowerCase()===this.type.PLATFORM:!1,t.isLeftSlope=t.type?t.type.toLowerCase()===this.type.L_SLOPE:!1,t.isRightSlope=t.type?t.type.toLowerCase()===this.type.R_SLOPE:!1,t.isBreakable=t.type?t.type.toLowerCase()===this.type.BREAKABLE:!1,t.isLadder=t.type?t.type.toLowerCase()===this.type.LADDER:!1,t.isTopLadder=t.type?t.type.toLowerCase()===this.type.TOPLADDER:!1,t.isSlope=t.isLeftSlope||t.isRightSlope,t.isCollidable=!!t.type,this.TileProperties[e]=t},contains:function(e){return e>=this.firstgid&&this.lastgid>=e},getTileImage:function(e){var t=me.video.createCanvasSurface(this.tilewidth,this.tileheight);return this.drawTile(t,0,0,e),t.canvas},getTileProperties:function(e){return this.TileProperties[e]},isTileCollidable:function(e){return this.TileProperties[e].isCollidable},getTileOffsetX:function(e){return null==this.tileXOffset[e]&&(this.tileXOffset[e]=this.margin+(this.spacing+this.tilewidth)*(e%this.hTileCount)),this.tileXOffset[e]},getTileOffsetY:function(e){return null==this.tileYOffset[e]&&(this.tileYOffset[e]=this.margin+(this.spacing+this.tileheight)*~~(e/this.hTileCount)),this.tileYOffset[e]},drawTile:function(e,t,i,n){if(n.flipped){var s=1,r=0,o=0,a=1,h=t,l=i;t=i=0,e.save(),n.flipAD&&(s=0,r=1,o=1,a=0,l+=this.tileheight-this.tilewidth),n.flipX&&(s=-s,o=-o,h+=n.flipAD?this.tileheight:this.tilewidth),n.flipY&&(r=-r,a=-a,l+=n.flipAD?this.tilewidth:this.tileheight),e.transform(s,r,o,a,h,l)}var u=n.tileId-this.firstgid;e.drawImage(this.image,this.getTileOffsetX(u),this.getTileOffsetY(u),this.tilewidth,this.tileheight,t,i,this.tilewidth,this.tileheight),n.flipped&&e.restore()}}),me.TMXTilesetGroup=Object.extend({init:function(){this.tilesets=[]},add:function(e){this.tilesets.push(e)},getTilesetByIndex:function(e){return this.tilesets[e]},getTilesetByGid:function(e){for(var t=-1,i=0,n=this.tilesets.length;n>i;i++){if(this.tilesets[i].contains(e))return this.tilesets[i];this.tilesets[i].firstgid==this.tilesets[i].lastgid&&e>=this.tilesets[i].firstgid&&(t=i)}if(-1!=t)return this.tilesets[t];throw"no matching tileset found for gid "+e}})}(window),function(){me.TMXOrthogonalRenderer=Object.extend({init:function(e,t,i,n){this.cols=e,this.rows=t,this.tilewidth=i,this.tileheight=n},canRender:function(e){return"orthogonal"===e.orientation&&this.cols===e.cols&&this.rows===e.rows&&this.tilewidth===e.tilewidth&&this.tileheight===e.tileheight},pixelToTileCoords:function(e,t){return new me.Vector2d(e/this.tilewidth,t/this.tileheight)},tileToPixelCoords:function(e,t){return new me.Vector2d(e*this.tilewidth,t*this.tileheight)},adjustPosition:function(e){"number"==typeof e.gid&&(e.y-=e.height)},drawTile:function(e,t,i,n,s){s.drawTile(e,s.tileoffset.x+t*this.tilewidth,s.tileoffset.y+(i+1)*this.tileheight-s.tileheight,n)},drawTileLayer:function(e,t,i,n){var s=this.pixelToTileCoords(i.x+n.pos.x,i.y+n.pos.y).floorSelf(),r=this.pixelToTileCoords(i.x+n.pos.x+n.width+this.tilewidth,i.y+n.pos.y+n.height+this.tileheight).ceilSelf();r.x=r.x>this.cols?this.cols:r.x,r.y=r.y>this.rows?this.rows:r.y;for(var o=s.y;r.y>o;o++)for(var a=s.x;r.x>a;a++){var h=t.layerData[a][o];h&&(t.tileset.contains(h.tileId)||(t.tileset=t.tilesets.getTilesetByGid(h.tileId)),this.drawTile(e,a,o,h,t.tileset))}}}),me.TMXIsometricRenderer=Object.extend({init:function(e,t,i,n){this.cols=e,this.rows=t,this.tilewidth=i,this.tileheight=n,this.hTilewidth=i/2,this.hTileheight=n/2,this.originX=this.rows*this.hTilewidth},canRender:function(e){return"isometric"===e.orientation&&this.cols===e.cols&&this.rows===e.rows&&this.tilewidth===e.tilewidth&&this.tileheight===e.tileheight},pixelToTileCoords:function(e,t){e-=this.originX;var i=t/this.tileheight,n=e/this.tilewidth;return new me.Vector2d(i+n,i-n)},tileToPixelCoords:function(e,t){return new me.Vector2d((e-t)*this.hTilewidth+this.originX,(e+t)*this.hTileheight)},adjustPosition:function(e){var t=e.x/this.hTilewidth,i=e.y/this.tileheight,n=this.tileToPixelCoords(t,i);n.x-=e.width/2,n.y-=e.height,e.x=n.x,e.y=n.y},drawTile:function(e,t,i,n,s){s.drawTile(e,(this.cols-1)*s.tilewidth+(t-i)*s.tilewidth>>1,-s.tilewidth+(t+i)*s.tileheight>>2,n)},drawTileLayer:function(e,t,i,n){var s=t.tileset,r=s.tileoffset,o=this.pixelToTileCoords(i.x+n.pos.x-s.tilewidth,i.y+n.pos.y-s.tileheight).floorSelf(),a=this.pixelToTileCoords(i.x+n.pos.x+n.width+s.tilewidth,i.y+n.pos.y+n.height+s.tileheight).ceilSelf(),h=this.tileToPixelCoords(a.x,a.y),l=this.tileToPixelCoords(o.x,o.y);l.x-=this.hTilewidth,l.y+=this.tileheight;var u=l.y-n.pos.y+i.y>this.hTileheight,c=n.pos.x+i.x-l.x<this.hTilewidth;u&&(c?(o.x--,l.x-=this.hTilewidth):(o.y--,l.x+=this.hTilewidth),l.y-=this.hTileheight);for(var m=u^c,d=o.clone(),f=l.y;f-this.tileheight<h.y;f+=this.hTileheight){d.setV(o);for(var p=l.x;h.x>p;p+=this.tilewidth){if(d.x>=0&&d.y>=0&&d.x<this.cols&&d.y<this.rows){var g=t.layerData[d.x][d.y];g&&(s.contains(g.tileId)||(s=t.tileset=t.tilesets.getTilesetByGid(g.tileId),r=s.tileoffset),s.drawTile(e,r.x+p,r.y+f-s.tileheight,g))}d.x++,d.y--}m?(o.y++,l.x-=this.hTilewidth,m=!1):(o.x++,l.x+=this.hTilewidth,m=!0)}}})}(window),function(){me.ColorLayer=me.Renderable.extend({init:function(e,t,i){this.name=e,this.color=me.utils.HexToRGB(t),this.z=i,this.opacity=1,this.floating=!0,this.parent(new me.Vector2d(0,0),me.game.viewport.width,me.game.viewport.height)},reset:function(){},getOpacity:function(){return this.opacity},setOpacity:function(e){"number"==typeof e&&(this.opacity=e.clamp(0,1))},update:function(){return!1},draw:function(e,t){var i=e.globalAlpha;e.globalAlpha=this.opacity,e.fillStyle=this.color,e.fillRect(t.left,t.top,t.width,t.height),e.globalAlpha=i}}),me.ImageLayer=me.Renderable.extend({ratio:1,init:function(e,t,i,n,s,r){if(this.name=e,this.image=n?me.loader.getImage(me.utils.getBasename(n)):null,!this.image)throw"melonJS: '"+n+"' file for Image Layer '"+this.name+"' not found!";this.imagewidth=this.image.width,this.imageheight=this.image.height,this.z=s,this.ratio=r||1,this.viewport=me.game.viewport,this.lastpos=this.viewport.pos.clone(),t=t?Math.min(this.viewport.width,t):this.viewport.width,i=i?Math.min(this.viewport.height,i):this.viewport.height,this.parent(new me.Vector2d(0,0),t,i),this.opacity=1,this.floating=!0,this._repeat="repeat",this.repeatX=!0,this.repeatY=!0,Object.defineProperty(this,"repeat",{get:function(){return this._repeat},set:function(e){switch(this._repeat=e,this._repeat){case"no-repeat":this.repeatX=!1,this.repeatY=!1;break;case"repeat-x":this.repeatX=!0,this.repeatY=!1;break;case"repeat-y":this.repeatX=!1,this.repeatY=!0;break;default:this.repeatX=!0,this.repeatY=!0}}}),this.anchorPoint.set(0,0)},reset:function(){this.image=null,this.lastpos=null,this.viewport=null},getOpacity:function(){return this.opacity},setOpacity:function(e){"number"==typeof e&&(this.opacity=e.clamp(0,1))},update:function(){if(0===this.ratio)return!1;var e=this.viewport.pos;return this.lastpos.equals(e)?!1:(this.pos.x+=(e.x-this.lastpos.x)*this.ratio%this.imagewidth,this.pos.x=(this.imagewidth+this.pos.x)%this.imagewidth,this.pos.y+=(e.y-this.lastpos.y)*this.ratio%this.imageheight,this.pos.y=(this.imageheight+this.pos.y)%this.imageheight,this.lastpos.setV(e),!0)},draw:function(e,t){if(e.save(),(0!==this.anchorPoint.y||0!==this.anchorPoint.x)&&e.translate(~~(this.anchorPoint.x*(this.viewport.width-this.imagewidth)),~~(this.anchorPoint.y*(this.viewport.height-this.imageheight))),e.globalAlpha=this.opacity,0===this.ratio){var i=Math.min(t.width,this.imagewidth),n=Math.min(t.height,this.imageheight);e.drawImage(this.image,t.left,t.top,i,n,t.left,t.top,i,n)}else for(var s=~~this.pos.x,r=~~this.pos.y,o=0,a=0,i=Math.min(this.imagewidth-s,this.width),n=Math.min(this.imageheight-r,this.height);;){do e.drawImage(this.image,s,r,i,n,o,a,i,n),r=0,a+=n,n=Math.min(this.imageheight,this.height-a);while(this.repeatY&&this.height>a);if(o+=i,!this.repeatX||o>=this.width)break;s=0,i=Math.min(this.imagewidth,this.width-o),r=~~this.pos.y,a=0,n=Math.min(this.imageheight-~~this.pos.y,this.height)}e.restore()}}),me.CollisionTiledLayer=me.Renderable.extend({init:function(e,t){this.parent(new me.Vector2d(0,0),e,t),this.isCollisionMap=!0},reset:function(){},checkCollision:function(e,t){var i=0>t.x?e.left+t.x:e.right+t.x,n=0>t.y?e.top+t.y:e.bottom+t.y,s={x:0,y:0,xprop:{},yprop:{}};return(0>=i||i>=this.width)&&(s.x=t.x),(0>=n||n>=this.height)&&(s.y=t.y),s}}),me.TMXLayer=me.Renderable.extend({layerData:null,init:function(e,t,i,n,s){this.tilewidth=e,this.tileheight=t,this.orientation=i,this.z=s,this.tilesets=n,this.tileset=this.tilesets?this.tilesets.getTilesetByIndex(0):null,this.parent(new me.Vector2d(0,0),0,0)},initFromXML:function(e){this.name=me.mapReader.TMXParser.getStringAttribute(e,me.TMX_TAG_NAME),this.visible=1==me.mapReader.TMXParser.getIntAttribute(e,me.TMX_TAG_VISIBLE,1),this.opacity=me.mapReader.TMXParser.getFloatAttribute(e,me.TMX_TAG_OPACITY,1).clamp(0,1),this.cols=me.mapReader.TMXParser.getIntAttribute(e,me.TMX_TAG_WIDTH),this.rows=me.mapReader.TMXParser.getIntAttribute(e,me.TMX_TAG_HEIGHT),this.width=this.cols*this.tilewidth,this.height=this.rows*this.tileheight,me.TMXUtils.applyTMXPropertiesFromXML(this,e),void 0===this.preRender&&(this.preRender=me.sys.preRender),this.isCollisionMap=this.name.toLowerCase().contains(me.COLLISION_LAYER),this.isCollisionMap&&!me.debug.renderCollisionMap&&(this.visible=!1),this.preRender&&(this.layerCanvas=me.video.createCanvas(this.cols*this.tilewidth,this.rows*this.tileheight),this.layerSurface=this.layerCanvas.getContext("2d"),me.video.setImageSmoothing(this.layerSurface,me.sys.scalingInterpolation),this.layerSurface.globalAlpha=this.opacity)},initFromJSON:function(e){this.name=e[me.TMX_TAG_NAME],this.visible=e[me.TMX_TAG_VISIBLE],this.opacity=parseFloat(e[me.TMX_TAG_OPACITY]).clamp(0,1),this.cols=parseInt(e[me.TMX_TAG_WIDTH]),this.rows=parseInt(e[me.TMX_TAG_HEIGHT]),this.width=this.cols*this.tilewidth,this.height=this.rows*this.tileheight,me.TMXUtils.applyTMXPropertiesFromJSON(this,e),void 0===this.preRender&&(this.preRender=me.sys.preRender),this.isCollisionMap=this.name.toLowerCase().contains(me.COLLISION_LAYER),this.isCollisionMap&&!me.debug.renderCollisionMap&&(this.visible=!1),this.preRender&&(this.layerCanvas=me.video.createCanvas(this.cols*this.tilewidth,this.rows*this.tileheight),this.layerSurface=this.layerCanvas.getContext("2d"),me.video.setImageSmoothing(this.layerSurface,me.sys.scalingInterpolation),this.layerSurface.globalAlpha=this.opacity)},reset:function(){this.preRender&&(this.layerCanvas=null,this.layerSurface=null),this.renderer=null,this.layerData=null,this.tileset=null,this.tilesets=null},setRenderer:function(e){this.renderer=e},initArray:function(e,t){this.layerData=[];for(var i=0;e>i;i++){this.layerData[i]=[];for(var n=0;t>n;n++)this.layerData[i][n]=null}},getTileId:function(e,t){var i=this.getTile(e,t);return i?i.tileId:null},getTile:function(e,t){return this.layerData[~~(e/this.tilewidth)][~~(t/this.tileheight)]},setTile:function(e,t,i){this.layerData[e][t]=new me.Tile(e,t,this.tilewidth,this.tileheight,i)},clearTile:function(e,t){this.layerData[e][t]=null,this.visible&&this.preRender&&this.layerSurface.clearRect(e*this.tilewidth,t*this.tileheight,this.tilewidth,this.tileheight)},getOpacity:function(){return this.opacity},setOpacity:function(e){"number"==typeof e&&(this.opacity=e.clamp(0,1),this.preRender&&(this.layerSurface.globalAlpha=this.opacity))},checkCollision:function(e,t){var i=0>t.x?~~(e.left+t.x):Math.ceil(e.right-1+t.x),n=0>t.y?~~(e.top+t.y):Math.ceil(e.bottom-1+t.y),s={x:0,xtile:void 0,xprop:{},y:0,ytile:void 0,yprop:{}};return 0>=i||i>=this.width?s.x=t.x:0!=t.x&&(s.xtile=this.getTile(i,Math.ceil(e.bottom-1)),s.xtile&&this.tileset.isTileCollidable(s.xtile.tileId)?(s.x=t.x,s.xprop=this.tileset.getTileProperties(s.xtile.tileId)):(s.xtile=this.getTile(i,~~e.top),s.xtile&&this.tileset.isTileCollidable(s.xtile.tileId)&&(s.x=t.x,s.xprop=this.tileset.getTileProperties(s.xtile.tileId)))),s.ytile=this.getTile(0>t.x?~~e.left:Math.ceil(e.right-1),n),s.ytile&&this.tileset.isTileCollidable(s.ytile.tileId)?(s.y=t.y||1,s.yprop=this.tileset.getTileProperties(s.ytile.tileId)):(s.ytile=this.getTile(0>t.x?Math.ceil(e.right-1):~~e.left,n),s.ytile&&this.tileset.isTileCollidable(s.ytile.tileId)&&(s.y=t.y||1,s.yprop=this.tileset.getTileProperties(s.ytile.tileId))),s},update:function(){return!1},draw:function(e,t){var i=me.game.viewport.pos;if(this.preRender){var n=Math.min(t.width,this.width),s=Math.min(t.height,this.height);e.drawImage(this.layerCanvas,i.x+t.pos.x,i.y+t.pos.y,n,s,i.x+t.pos.x,i.y+t.pos.y,n,s)}else{var r=e.globalAlpha;e.globalAlpha=this.opacity,this.renderer.drawTileLayer(e,this,i,t),e.globalAlpha=r}}})}(window),function(){me.TMXTileMap=me.Renderable.extend({init:function(e){this.levelId=e,this.z=0,this.name=null,this.cols=0,this.rows=0,this.tilewidth=0,this.tileheight=0,this.tilesets=null,this.mapLayers=[],this.objectGroups=[],this.initialized=!1,this.version="",this.orientation="",this.tilesets=null,this.parent(new me.Vector2d,0,0)},reset:function(){if(this.initialized===!0){for(var e=this.mapLayers.length;e--;)this.mapLayers[e].reset(),this.mapLayers[e]=null;for(var e=this.objectGroups.length;e--;)this.objectGroups[e].reset(),this.objectGroups[e]=null;this.tilesets=null,this.mapLayers.length=0,this.objectGroups.length=0,this.pos.set(0,0),this.initialized=!1}},getObjectGroupByName:function(e){var t=null;e=e.trim().toLowerCase();for(var i=this.objectGroups.length;i--;)if(this.objectGroups[i].name.toLowerCase().contains(e)){t=this.objectGroups[i];break}return t},getObjectGroups:function(){return this.objectGroups},getLayers:function(){return this.mapLayers},getLayerByName:function(e){var t=null;e=e.trim().toLowerCase();for(var i=this.mapLayers.length;i--;)if(this.mapLayers[i].name.toLowerCase().contains(e)){t=this.mapLayers[i];break}return e.toLowerCase().contains(me.COLLISION_LAYER)&&null==t&&(t=new me.CollisionTiledLayer(me.game.currentLevel.width,me.game.currentLevel.height)),t},clearTile:function(e,t){for(var i=this.mapLayers.length;i--;)this.mapLayers[i]instanceof me.TMXLayer&&this.mapLayers[i].clearTile(e,t)}})}(window),function(){function e(){var e={tmxDoc:null,setData:function(e){this.tmxDoc=e},getFirstElementByTagName:function(e){return this.tmxDoc?this.tmxDoc.getElementsByTagName(e)[0]:null},getAllTagElements:function(){return this.tmxDoc?this.tmxDoc.getElementsByTagName("*"):null},getStringAttribute:function(e,t,i){var n=e.getAttribute(t);return n?n.trim():i},getIntAttribute:function(e,t,i){var n=this.getStringAttribute(e,t,i);return n?parseInt(n):i},getFloatAttribute:function(e,t,i){var n=this.getStringAttribute(e,t,i);return n?parseFloat(n):i},getBooleanAttribute:function(e,t,i){var n=this.getStringAttribute(e,t,i);return n?"true"==n:i},free:function(){this.tmxDoc=null}};return e}me.TMXMapReader=Object.extend({XMLReader:null,JSONReader:null,TMXParser:null,readMap:function(e){if(!e.initialized){if("xml"===me.loader.getTMXFormat(e.levelId)?(null===this.XMLReader&&(this.XMLReader=new t),this.TMXParser=this.XMLReader.TMXParser,this.XMLReader.readXMLMap(e,me.loader.getTMX(e.levelId))):(null===this.JSONReader&&(this.JSONReader=new i),this.JSONReader.readJSONMap(e,me.loader.getTMX(e.levelId))),e.width<me.game.viewport.width||e.height<me.game.viewport.height){var n=~~((me.game.viewport.width-e.width)/2),s=~~((me.game.viewport.height-e.height)/2);e.pos.add({x:n>0?n:0,y:s>0?s:0})}e.initialized=!0}},getNewDefaultRenderer:function(e){switch(e.orientation){case"orthogonal":return new me.TMXOrthogonalRenderer(e.cols,e.rows,e.tilewidth,e.tileheight);case"isometric":return new me.TMXIsometricRenderer(e.cols,e.rows,e.tilewidth,e.tileheight);default:throw"melonJS: "+e.orientation+" type TMX Tile Map not supported!"}},setLayerData:function(e,t,i,n){switch(e.initArray(e.cols,e.rows),i){case null:var t=t.getElementsByTagName(me.TMX_TAG_TILE);break;case"json":break;case me.TMX_TAG_CSV:case me.TMX_TAG_ATTR_BASE64:for(var s="",r=0,o=t.childNodes.length;o>r;r++)s+=t.childNodes[r].nodeValue;if(i==me.TMX_TAG_CSV)var t=me.utils.decodeCSV(s,e.cols);else{var t=me.utils.decodeBase64AsArray(s,4);null!==n&&(t=me.utils.decompress(t,n))}s=null;break;default:throw"melonJS: TMX Tile Map "+i+" encoding not supported!"}for(var a=0,h=0;e.rows>h;h++)for(var l=0;e.cols>l;l++){var u=null==i?this.TMXParser.getIntAttribute(t[a++],me.TMX_TAG_GID):t[a++];if(0!==u){var c=new me.Tile(l,h,e.tilewidth,e.tileheight,u);e.layerData[l][h]=c,e.tileset.contains(c.tileId)||(e.tileset=e.tilesets.getTilesetByGid(c.tileId)),e.visible&&e.preRender&&e.renderer.drawTile(e.layerSurface,l,h,c,e.tileset)}}}});var t=me.TMXMapReader.extend({TMXParser:null,init:function(){this.TMXParser||(this.TMXParser=new e)},readXMLMap:function(e,t){if(!t)throw"melonJS:"+e.levelId+" TMX map not found";var i=0;this.TMXParser.setData(t);for(var n=this.TMXParser.getAllTagElements(),s=0;n.length>s;s++)switch(n.item(s).nodeName){case me.TMX_TAG_MAP:var r=n.item(s);e.version=this.TMXParser.getStringAttribute(r,me.TMX_TAG_VERSION),e.orientation=this.TMXParser.getStringAttribute(r,me.TMX_TAG_ORIENTATION),e.cols=this.TMXParser.getIntAttribute(r,me.TMX_TAG_WIDTH),e.rows=this.TMXParser.getIntAttribute(r,me.TMX_TAG_HEIGHT),e.tilewidth=this.TMXParser.getIntAttribute(r,me.TMX_TAG_TILEWIDTH),e.tileheight=this.TMXParser.getIntAttribute(r,me.TMX_TAG_TILEHEIGHT),e.width=e.cols*e.tilewidth,e.height=e.rows*e.tileheight,e.backgroundcolor=this.TMXParser.getStringAttribute(r,me.TMX_BACKGROUND_COLOR),e.z=i++,me.TMXUtils.applyTMXPropertiesFromXML(e,r),e.background_color=e.backgroundcolor?e.backgroundcolor:e.background_color,e.background_color&&e.mapLayers.push(new me.ColorLayer("background_color",e.background_color,i++)),e.background_image&&e.mapLayers.push(new me.ImageLayer("background_image",e.width,e.height,e.background_image,i++)),null!==me.game.renderer&&me.game.renderer.canRender(e)||(me.game.renderer=this.getNewDefaultRenderer(e));break;case me.TMX_TAG_TILESET:e.tilesets||(e.tilesets=new me.TMXTilesetGroup),e.tilesets.add(this.readTileset(n.item(s)));break;case me.TMX_TAG_IMAGE_LAYER:e.mapLayers.push(this.readImageLayer(e,n.item(s),i++));break;case me.TMX_TAG_LAYER:e.mapLayers.push(this.readLayer(e,n.item(s),i++));break;case me.TMX_TAG_OBJECTGROUP:e.objectGroups.push(this.readObjectGroup(e,n.item(s),i++));break;default:}this.TMXParser.free()},readLayer:function(e,t,i){var n=new me.TMXLayer(e.tilewidth,e.tileheight,e.orientation,e.tilesets,i);n.initFromXML(t);var s=t.getElementsByTagName(me.TMX_TAG_DATA)[0],r=this.TMXParser.getStringAttribute(s,me.TMX_TAG_ENCODING,null),o=this.TMXParser.getStringAttribute(s,me.TMX_TAG_COMPRESSION,null);return""==r&&(r=null),""==o&&(o=null),(!n.isCollisionMap||me.debug.renderCollisionMap)&&(me.game.renderer.canRender(n)?n.setRenderer(me.game.renderer):n.setRenderer(me.mapReader.getNewDefaultRenderer(n))),this.setLayerData(n,s,r,o),s=null,n},readImageLayer:function(e,t,i){var n=this.TMXParser.getStringAttribute(t,me.TMX_TAG_NAME),s=this.TMXParser.getIntAttribute(t,me.TMX_TAG_WIDTH),r=this.TMXParser.getIntAttribute(t,me.TMX_TAG_HEIGHT),o=t.getElementsByTagName(me.TMX_TAG_IMAGE)[0].getAttribute(me.TMX_TAG_SOURCE),a=new me.ImageLayer(n,s*e.tilewidth,r*e.tileheight,o,i);return a.visible=1==this.TMXParser.getIntAttribute(t,me.TMX_TAG_VISIBLE,1),a.opacity=this.TMXParser.getFloatAttribute(t,me.TMX_TAG_OPACITY,1),me.TMXUtils.applyTMXPropertiesFromXML(a,t),a},readTileset:function(e){var t=new me.TMXTileset;return t.initFromXML(e),t},readObjectGroup:function(e,t,i){var n=this.TMXParser.getStringAttribute(t,me.TMX_TAG_NAME),s=new me.TMXOBjectGroup;return s.initFromXML(n,t,e.tilesets,i),s}}),i=me.TMXMapReader.extend({readJSONMap:function(e,t){if(!t)throw"melonJS:"+e.levelId+" TMX map not found";var i=0,n=this;e.version=t[me.TMX_TAG_VERSION],e.orientation=t[me.TMX_TAG_ORIENTATION],e.cols=parseInt(t[me.TMX_TAG_WIDTH]),e.rows=parseInt(t[me.TMX_TAG_HEIGHT]),e.tilewidth=parseInt(t[me.TMX_TAG_TILEWIDTH]),e.tileheight=parseInt(t[me.TMX_TAG_TILEHEIGHT]),e.width=e.cols*e.tilewidth,e.height=e.rows*e.tileheight,e.backgroundcolor=t[me.TMX_BACKGROUND_COLOR],e.z=i++,me.TMXUtils.applyTMXPropertiesFromJSON(e,t),e.background_color=e.backgroundcolor?e.backgroundcolor:e.background_color,e.background_color&&e.mapLayers.push(new me.ColorLayer("background_color",e.background_color,i++)),e.background_image&&e.mapLayers.push(new me.ImageLayer("background_image",e.width,e.height,e.background_image,i++)),null!==me.game.renderer&&me.game.renderer.canRender(e)||(me.game.renderer=this.getNewDefaultRenderer(e)),e.tilesets||(e.tilesets=new me.TMXTilesetGroup),t.tilesets.forEach(function(t){e.tilesets.add(n.readTileset(t))}),t.layers.forEach(function(t){switch(t.type){case me.TMX_TAG_IMAGE_LAYER:e.mapLayers.push(n.readImageLayer(e,t,i++));break;case me.TMX_TAG_TILE_LAYER:e.mapLayers.push(n.readLayer(e,t,i++));break;case me.TMX_TAG_OBJECTGROUP:e.objectGroups.push(n.readObjectGroup(e,t,i++));break;default:}})},readLayer:function(e,t,i){var n=new me.TMXLayer(e.tilewidth,e.tileheight,e.orientation,e.tilesets,i);return n.initFromJSON(t),n.isCollisionMap||(me.game.renderer.canRender(n)?n.setRenderer(me.game.renderer):n.setRenderer(me.mapReader.getNewDefaultRenderer(n))),this.setLayerData(n,t[me.TMX_TAG_DATA],"json",null),n},readImageLayer:function(e,t,i){var n=t[me.TMX_TAG_NAME],s=parseInt(t[me.TMX_TAG_WIDTH]),r=parseInt(t[me.TMX_TAG_HEIGHT]),o=t[me.TMX_TAG_IMAGE],a=new me.ImageLayer(n,s*e.tilewidth,r*e.tileheight,o,i);return a.visible=t[me.TMX_TAG_VISIBLE],a.opacity=parseFloat(t[me.TMX_TAG_OPACITY]),me.TMXUtils.applyTMXPropertiesFromJSON(a,t),a.ratio=parseFloat(a.ratio),a},readTileset:function(e){var t=new me.TMXTileset;return t.initFromJSON(e),t},readObjectGroup:function(e,t,i){var n=new me.TMXOBjectGroup;return n.initFromJSON(t[me.TMX_TAG_NAME],t,e.tilesets,i),n}})}(window),function(){me.levelDirector=function(){var e={},t={},i=[],n=0;return e.reset=function(){},e.addLevel=function(){throw"melonJS: no level loader defined"},e.addTMXLevel=function(e,n){return null!=t[e]?!1:(t[e]=new me.TMXTileMap(e),t[e].name=e,i.push(e),n&&n(),!0)},e.loadLevel=function(s){if(s=(""+s).toLowerCase(),void 0===t[s])throw"melonJS: level "+s+" not found";if(!(t[s]instanceof me.TMXTileMap))throw"melonJS: no level loader defined";var r=me.state.isRunning();return r&&me.state.pause(),me.game.reset(),me.utils.resetGUID(s),t[e.getCurrentLevelId()]&&t[e.getCurrentLevelId()].reset(),me.mapReader.readMap(t[s]),n=i.indexOf(s),me.game.loadTMXLevel(t[s]),r&&me.state.resume(),!0},e.getCurrentLevelId=function(){return i[n]},e.reloadLevel=function(){return e.loadLevel(e.getCurrentLevelId())},e.nextLevel=function(){return i.length>n+1?e.loadLevel(i[n+1]):!1},e.previousLevel=function(){return n-1>=0?e.loadLevel(i[n-1]):!1},e.levelCount=function(){return i.length},e}()}(window),/**
 * @preserve Tween JS
 * https://github.com/sole/Tween.js
 */
function(){me.Tween=function(e){var t=e,i={},n={},s={},r=1e3,o=0,a=null,h=0,l=me.Tween.Easing.Linear.EaseNone,u=null,c=null,m=null;this.alwaysUpdate=!0,this.to=function(e,i){void 0!==i&&(r=i);for(var n in e)null!==t[n]&&(s[n]=e[n]);return this},this.start=function(){me.game.add(this,999),a=me.timer.getTime()+o,h=0;for(var e in s)null!==t[e]&&(i[e]=t[e],n[e]=s[e]-t[e]);return this},this.stop=function(){return me.game.remove(this,!0),this},this.delay=function(e){return o=e,this},me.event.subscribe(me.event.STATE_PAUSE,function(){a&&(h=me.timer.getTime())}),me.event.subscribe(me.event.STATE_RESUME,function(){a&&h&&(a+=me.timer.getTime()-h)}),this.easing=function(e){return l=e,this},this.chain=function(e){return u=e,this},this.onUpdate=function(e){return c=e,this},this.onComplete=function(e){return m=e,this},this.update=function(){var e,s,o,h=me.timer.getTime();if(a>h)return!0;(s=(h-a)/r)>=1&&(s=1),o=l(s);for(e in n)t[e]=i[e]+n[e]*o;return null!==c&&c.call(t,o),1===s?(me.game.remove(this,!0),null!==m&&m.call(t),null!==u&&u.start(),!1):!0}},me.Tween.Easing={Linear:{},Quadratic:{},Cubic:{},Quartic:{},Quintic:{},Sinusoidal:{},Exponential:{},Circular:{},Elastic:{},Back:{},Bounce:{}},me.Tween.Easing.Linear.EaseNone=function(e){return e},me.Tween.Easing.Quadratic.EaseIn=function(e){return e*e},me.Tween.Easing.Quadratic.EaseOut=function(e){return e*(2-e)},me.Tween.Easing.Quadratic.EaseInOut=function(e){return 1>(e*=2)?.5*e*e:-.5*(--e*(e-2)-1)},me.Tween.Easing.Cubic.EaseIn=function(e){return e*e*e},me.Tween.Easing.Cubic.EaseOut=function(e){return--e*e*e+1},me.Tween.Easing.Cubic.EaseInOut=function(e){return 1>(e*=2)?.5*e*e*e:.5*((e-=2)*e*e+2)},me.Tween.Easing.Quartic.EaseIn=function(e){return e*e*e*e},me.Tween.Easing.Quartic.EaseOut=function(e){return 1- --e*e*e*e},me.Tween.Easing.Quartic.EaseInOut=function(e){return 1>(e*=2)?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)},me.Tween.Easing.Quintic.EaseIn=function(e){return e*e*e*e*e},me.Tween.Easing.Quintic.EaseOut=function(e){return--e*e*e*e*e+1},me.Tween.Easing.Quintic.EaseInOut=function(e){return 1>(e*=2)?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)},me.Tween.Easing.Sinusoidal.EaseIn=function(e){return 1-Math.cos(e*Math.PI/2)},me.Tween.Easing.Sinusoidal.EaseOut=function(e){return Math.sin(e*Math.PI/2)},me.Tween.Easing.Sinusoidal.EaseInOut=function(e){return.5*(1-Math.cos(Math.PI*e))},me.Tween.Easing.Exponential.EaseIn=function(e){return 0===e?0:Math.pow(1024,e-1)},me.Tween.Easing.Exponential.EaseOut=function(e){return 1===e?1:1-Math.pow(2,-10*e)},me.Tween.Easing.Exponential.EaseInOut=function(e){return 0===e?0:1===e?1:1>(e*=2)?.5*Math.pow(1024,e-1):.5*(-Math.pow(2,-10*(e-1))+2)},me.Tween.Easing.Circular.EaseIn=function(e){return 1-Math.sqrt(1-e*e)},me.Tween.Easing.Circular.EaseOut=function(e){return Math.sqrt(1- --e*e)},me.Tween.Easing.Circular.EaseInOut=function(e){return 1>(e*=2)?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)},me.Tween.Easing.Elastic.EaseIn=function(e){var t,i=.1,n=.4;return 0===e?0:1===e?1:(!i||1>i?(i=1,t=n/4):t=n*Math.asin(1/i)/(2*Math.PI),-(i*Math.pow(2,10*(e-=1))*Math.sin((e-t)*2*Math.PI/n)))},me.Tween.Easing.Elastic.EaseOut=function(e){var t,i=.1,n=.4;return 0===e?0:1===e?1:(!i||1>i?(i=1,t=n/4):t=n*Math.asin(1/i)/(2*Math.PI),i*Math.pow(2,-10*e)*Math.sin((e-t)*2*Math.PI/n)+1)},me.Tween.Easing.Elastic.EaseInOut=function(e){var t,i=.1,n=.4;return 0===e?0:1===e?1:(!i||1>i?(i=1,t=n/4):t=n*Math.asin(1/i)/(2*Math.PI),1>(e*=2)?-.5*i*Math.pow(2,10*(e-=1))*Math.sin((e-t)*2*Math.PI/n):.5*i*Math.pow(2,-10*(e-=1))*Math.sin((e-t)*2*Math.PI/n)+1)},me.Tween.Easing.Back.EaseIn=function(e){var t=1.70158;return e*e*((t+1)*e-t)},me.Tween.Easing.Back.EaseOut=function(e){var t=1.70158;return--e*e*((t+1)*e+t)+1},me.Tween.Easing.Back.EaseInOut=function(e){var t=2.5949095;return 1>(e*=2)?.5*e*e*((t+1)*e-t):.5*((e-=2)*e*((t+1)*e+t)+2)},me.Tween.Easing.Bounce.EaseIn=function(e){return 1-me.Tween.Easing.Bounce.EaseOut(1-e)},me.Tween.Easing.Bounce.EaseOut=function(e){return 1/2.75>e?7.5625*e*e:2/2.75>e?7.5625*(e-=1.5/2.75)*e+.75:2.5/2.75>e?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},me.Tween.Easing.Bounce.EaseInOut=function(e){return.5>e?.5*me.Tween.Easing.Bounce.EaseIn(2*e):.5*me.Tween.Easing.Bounce.EaseOut(2*e-1)+.5}}(),/**
 * @preserve MinPubSub
 * a micro publish/subscribe messaging framework
 * @see https://github.com/daniellmb/MinPubSub 
 * @author Daniel Lamb <daniellmb.com>
 *
 * Released under the MIT License
 */
function(){me.event=function(){var e={},t={};return e.STATE_PAUSE="me.state.onPause",e.STATE_RESUME="me.state.onResume",e.GAME_INIT="me.game.onInit",e.LEVEL_LOADED="me.game.onLevelLoaded",e.LOADER_COMPLETE="me.loader.onload",e.LOADER_PROGRESS="me.loader.onProgress",e.KEYDOWN="me.input.keydown",e.KEYUP="me.input.keyup",e.WINDOW_ONRESIZE="window.onresize",e.publish=function(e,i){for(var n=t[e],s=n?n.length:0;s--;)n[s].apply(window,i||[])},e.subscribe=function(e,i){return t[e]||(t[e]=[]),t[e].push(i),[e,i]},e.unsubscribe=function(e,i){for(var n=t[i?e:e[0]],i=i||e[1],s=n?n.length:0;s--;)n[s]===i&&n.splice(s,1)},e}()}(),function(){me.plugin=function(){var e={};return e.Base=Object.extend({version:void 0,init:function(){}}),e.patch=function(e,t,i){if(void 0!==e.prototype)var e=e.prototype;if("function"==typeof e[t]){var n=e[t];e[t]=function(e,t){return function(){var e=this.parent;this.parent=n;var i=t.apply(this,arguments);return this.parent=e,i}}(t,i)}else console.error(t+" is not an existing function")},e.register=function(e,t){if(me.plugin[t]&&console.error("plugin "+t+" already registered"),void 0===e.prototype.version)throw"melonJS: Plugin version not defined !";if(me.sys.checkVersion(e.prototype.version)>0)throw"melonJS: Plugin version mismatch, expected: "+e.prototype.version+", got: "+me.version;var i=[];if(arguments.length>2&&(i=Array.prototype.slice.call(arguments,1)),i[0]=e,me.plugin[t]=new(e.bind.apply(e,i)),!(me.plugin[t]instanceof me.plugin.Base))throw"melonJS: Plugin should extend the me.plugin.Base Class !"},e}()}();